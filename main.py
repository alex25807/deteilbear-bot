import logging
import os
import asyncio
import time
import datetime as dt
import re
from logging.handlers import RotatingFileHandler
from dotenv import load_dotenv
import pathlib

load_dotenv()

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, BotCommand, WebAppInfo
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    ContextTypes,
    filters,
)
from telegram.request import HTTPXRequest
import openai

from analytics import (
    log_new_client, log_question, log_token_usage, log_button_click,
    log_rating, generate_monthly_report, generate_text_summary,
    log_consent, has_consent, delete_user_data,
)

# ================== ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ ==================
TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
KNOWLEDGE_FILE_PATH = os.getenv("KNOWLEDGE_FILE_PATH", "knowledges.txt")
OPENAI_MODEL = os.getenv("OPENAI_MODEL", "gpt-4o-mini")
LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO").upper()
MAX_HISTORY = int(os.getenv("MAX_HISTORY", "20"))
ADMIN_USER_ID = int(os.getenv("ADMIN_USER_ID", "0"))
BOOKING_MARKER = "[Ð—ÐÐŸÐ˜Ð¡Ð¬]"
OPENAI_TIMEOUT = int(os.getenv("OPENAI_TIMEOUT", "30"))
RATING_DELAY = int(os.getenv("RATING_DELAY", "300"))
FOLLOWUP_DELAY = int(os.getenv("FOLLOWUP_DELAY", "86400"))
CACHE_TTL = int(os.getenv("CACHE_TTL", "21600"))

if not TELEGRAM_BOT_TOKEN:
    raise ValueError("TELEGRAM_BOT_TOKEN Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² .env")
if not OPENAI_API_KEY:
    raise ValueError("OPENAI_API_KEY Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² .env")

# ================== Ð›ÐžÐ“Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• ==================
pathlib.Path("logs").mkdir(parents=True, exist_ok=True)

logger = logging.getLogger(__name__)
logger.setLevel(getattr(logging, LOG_LEVEL))

formatter = logging.Formatter(
    "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
)

file_handler = RotatingFileHandler(
    "logs/bot.log",
    maxBytes=10 * 1024 * 1024,
    backupCount=5,
    encoding="utf-8"
)
file_handler.setFormatter(formatter)
logger.addHandler(file_handler)

console_handler = logging.StreamHandler()
console_handler.setFormatter(formatter)
logger.addHandler(console_handler)

logger.propagate = False

# ================== ÐšÐ›ÐÐ’Ð˜ÐÐ¢Ð£Ð Ð« ==================
BOOKING_KEYBOARD = InlineKeyboardMarkup([
    [InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/"))],
    [InlineKeyboardButton("âœ… Ð¯ Ð·Ð°Ð¿Ð¸ÑÐ°Ð»ÑÑ", callback_data="booking_done")],
])

PHONE_LINE = "\n\nðŸ“ž Ð˜Ð»Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð½Ð¸Ñ‚Ðµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ: +7 (926) 021-60-00"

GREETING_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("ðŸ”§ Ð£ÑÐ»ÑƒÐ³Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð²", callback_data="menu_services"),
        InlineKeyboardButton("ðŸš¿ Ð¡Ð°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ", callback_data="menu_self"),
    ],
    [
        InlineKeyboardButton("ðŸ§´ ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸Ð¸", callback_data="menu_shop"),
        InlineKeyboardButton("â˜• ÐšÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸", callback_data="menu_comfort"),
    ],
    [
        InlineKeyboardButton("ðŸ’° Ð¦ÐµÐ½Ñ‹", callback_data="menu_prices"),
        InlineKeyboardButton("ðŸ“ ÐšÐ°Ðº Ð½Ð°Ñ Ð½Ð°Ð¹Ñ‚Ð¸", callback_data="menu_address"),
    ],
    [
        InlineKeyboardButton("ðŸ† ÐÐ°ÑˆÐ¸ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°", callback_data="menu_advantages"),
        InlineKeyboardButton("ðŸ“¸ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚", callback_data="menu_portfolio"),
    ],
    [
        InlineKeyboardButton("ðŸ”¥ ÐÐ¾Ð²Ð¸Ð½ÐºÐ¸ Ð¸ Ð°ÐºÑ†Ð¸Ð¸", url="https://t.me/bearlake_detailing"),
    ],
    [
        InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/")),
    ],
])

WASH_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("ðŸš¿ Ð”Ð²ÑƒÑ…Ñ„Ð°Ð·Ð½Ð°Ñ Ð¼Ð¾Ð¹ÐºÐ° (2 500 â‚½)", callback_data="sub_wash_twophase"),
    ],
    [
        InlineKeyboardButton("ðŸ§½ ÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð°Ñ Ð¼Ð¾Ð¹ÐºÐ° (8 500 â‚½)", callback_data="sub_wash_complex"),
    ],
    [
        InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/")),
    ],
])

SERVICES_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("ðŸš¿ ÐœÐ¾Ð¹ÐºÐ°", callback_data="sub_wash"),
        InlineKeyboardButton("âœ¨ ÐŸÐ¾Ð»Ð¸Ñ€Ð¾Ð²ÐºÐ°", callback_data="sub_polish"),
    ],
    [
        InlineKeyboardButton("ðŸ›¡ Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð›ÐšÐŸ", callback_data="sub_protection"),
        InlineKeyboardButton("ðŸ§¹ Ð”ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³ ÑÐ°Ð»Ð¾Ð½Ð°", callback_data="sub_interior"),
    ],
    [
        InlineKeyboardButton("ðŸªŸ Ð‘Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚ÐµÐºÐ»Ð°", callback_data="sub_glass"),
        InlineKeyboardButton("ðŸ”§ Ð ÐµÐ¼Ð¾Ð½Ñ‚ ÑÐºÐ¾Ð»Ð¾Ð²", callback_data="sub_chips"),
    ],
    [
        InlineKeyboardButton("ðŸ’° Ð’ÑÐµ Ñ†ÐµÐ½Ñ‹", callback_data="sub_all_prices"),
    ],
    [
        InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/")),
    ],
])

SELF_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("ðŸ”§ ÐžÐ±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ", callback_data="sub_self_equip"),
        InlineKeyboardButton("ðŸ’° Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ", callback_data="sub_self_price"),
    ],
    [
        InlineKeyboardButton("ðŸ“‹ Ð§Ñ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾", callback_data="sub_self_included"),
        InlineKeyboardButton("âš ï¸ ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°", callback_data="sub_self_rules"),
    ],
    [
        InlineKeyboardButton("ðŸ§´ ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸ÑŽ", callback_data="menu_shop"),
    ],
    [
        InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/")),
    ],
])

SHOP_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("ðŸ§´ Ð§Ñ‚Ð¾ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚Ðµ", callback_data="sub_shop_recommend"),
        InlineKeyboardButton("ðŸ· Ð¡ÐºÐ¸Ð´ÐºÐ¸ Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹", callback_data="sub_shop_discounts"),
    ],
    [
        InlineKeyboardButton("ðŸ›’ ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ Ð½Ð° Ozon", url="https://ozon.ru/t/bal1Akq"),
        InlineKeyboardButton("ðŸª Ð¡Ð°Ð¹Ñ‚ ÑÑ‚ÑƒÐ´Ð¸Ð¸", url="https://bearlake.clients.site/"),
    ],
    [
        InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/")),
    ],
])

COMFORT_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("â˜• ÐšÐ¾Ñ„Ðµ Ð¸ Ð¿ÐµÑ€ÐµÐºÑƒÑÑ‹", callback_data="sub_comfort_food"),
        InlineKeyboardButton("ðŸ“¶ Wi-Fi Ð¸ Ð·Ð¾Ð½Ð° Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°", callback_data="sub_comfort_wifi"),
    ],
    [
        InlineKeyboardButton("â„ï¸ ÐšÐ»Ð¸Ð¼Ð°Ñ‚ Ð² Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ð¸", callback_data="sub_comfort_climate"),
        InlineKeyboardButton("â™¿ Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°Ñ ÑÑ€ÐµÐ´Ð°", callback_data="sub_comfort_access"),
    ],
    [
        InlineKeyboardButton("ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½", web_app=WebAppInfo(url="https://n1024167.yclients.com/")),
    ],
])

SUB_MENUS = {
    "menu_services": SERVICES_KEYBOARD,
    "menu_self": SELF_KEYBOARD,
    "menu_shop": SHOP_KEYBOARD,
    "menu_comfort": COMFORT_KEYBOARD,
    "sub_wash": WASH_KEYBOARD,
}

CONSENT_KEYBOARD = InlineKeyboardMarkup([
    [InlineKeyboardButton("âœ… ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÑŽ", callback_data="consent_accept")],
])

RATING_KEYBOARD = InlineKeyboardMarkup([
    [
        InlineKeyboardButton("1 â­", callback_data="rate_1"),
        InlineKeyboardButton("2 â­", callback_data="rate_2"),
        InlineKeyboardButton("3 â­", callback_data="rate_3"),
        InlineKeyboardButton("4 â­", callback_data="rate_4"),
        InlineKeyboardButton("5 â­", callback_data="rate_5"),
    ],
])

NO_CONSENT_TEXT = (
    "Ð”Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð±Ð¾Ñ‚Ð° Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð´Ð°Ñ‚ÑŒ ÑÐ¾Ð³Ð»Ð°ÑÐ¸Ðµ "
    "Ð½Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð´Ð°Ð½Ð½Ñ‹Ñ….\nÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ /start, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ."
)

PRIVACY_TEXT = (
    "ðŸ”’ ÐŸÐ¾Ð»Ð¸Ñ‚Ð¸ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸\n\n"
    "ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…:\n"
    "Ð¡Ñ‚ÑƒÐ´Ð¸Ñ BEARLAKE DETAILING & SHOP\n\n"
    "ðŸ“‹ ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:\n"
    "â€¢ Telegram ID (Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€)\n"
    "â€¢ Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² Ñ‡Ð°Ñ‚Ðµ Ñ Ð±Ð¾Ñ‚Ð¾Ð¼\n"
    "â€¢ Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¹\n"
    "â€¢ ÐÐ°Ð¶Ð°Ñ‚Ð¸Ñ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¼ÐµÐ½ÑŽ\n\n"
    "ðŸŽ¯ Ð¦ÐµÐ»Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:\n"
    "â€¢ ÐšÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼ ÑÑ‚ÑƒÐ´Ð¸Ð¸\n"
    "â€¢ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ\n"
    "â€¢ Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±ÐµÐ·Ð»Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ð¹ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸\n\n"
    "ðŸ›¡ Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…:\n"
    "â€¢ Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð½Ð° Ð·Ð°Ñ‰Ð¸Ñ‰Ñ‘Ð½Ð½Ð¾Ð¼ ÑÐµÑ€Ð²ÐµÑ€Ðµ\n"
    "â€¢ Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð¸Ð¼ÐµÑŽÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑƒÐ¿Ð¾Ð»Ð½Ð¾Ð¼Ð¾Ñ‡ÐµÐ½Ð½Ñ‹Ðµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¸\n"
    "â€¢ Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°ÑŽÑ‚ÑÑ Ñ‚Ñ€ÐµÑ‚ÑŒÐ¸Ð¼ Ð»Ð¸Ñ†Ð°Ð¼\n\n"
    "â± Ð¡Ñ€Ð¾Ðº Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ:\n"
    "Ð”Ð¾ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð²Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· /deletedata\n\n"
    "Ð’Ð°ÑˆÐ¸ Ð¿Ñ€Ð°Ð²Ð° (ÑÑ‚. 14â€“17 Ð¤Ð—-152):\n"
    "â€¢ ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾Ð± Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ…\n"
    "â€¢ ÐŸÐ¾Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ñ‚ÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ â€” /deletedata\n"
    "â€¢ ÐžÑ‚Ð¾Ð·Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð³Ð»Ð°ÑÐ¸Ðµ â€” /deletedata\n\n"
    "ðŸ“© ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚ Ð¿Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ ÐŸÐ”:\n"
    "+7 (926) 021-60-00"
)

TOPIC_LABELS = {
    "menu_services": "ÑƒÑÐ»ÑƒÐ³Ð°Ð¼Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð²",
    "menu_self": "Ð¿Ð¾ÑÑ‚Ð¾Ð¼ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ",
    "menu_prices": "Ñ†ÐµÐ½Ð°Ð¼Ð¸ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸",
    "menu_address": "Ð°Ð´Ñ€ÐµÑÐ¾Ð¼ ÑÑ‚ÑƒÐ´Ð¸Ð¸",
    "menu_shop": "Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð¼ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸Ð¸",
    "menu_comfort": "ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸",
    "sub_wash": "Ð¼Ð¾Ð¹ÐºÐ¾Ð¹",
    "sub_wash_twophase": "Ð´Ð²ÑƒÑ…Ñ„Ð°Ð·Ð½Ð¾Ð¹ Ð¼Ð¾Ð¹ÐºÐ¾Ð¹",
    "sub_wash_complex": "ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð¾Ð¹ Ð¼Ð¾Ð¹ÐºÐ¾Ð¹ Bearlake",
    "sub_polish": "Ð¿Ð¾Ð»Ð¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹",
    "sub_protection": "Ð·Ð°Ñ‰Ð¸Ñ‚Ð¾Ð¹ Ð›ÐšÐŸ",
    "sub_interior": "Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³Ð¾Ð¼ ÑÐ°Ð»Ð¾Ð½Ð°",
    "sub_glass": "Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÑÑ‚ÐµÐºÐ»Ð°",
    "sub_chips": "Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð¾Ð¼ ÑÐºÐ¾Ð»Ð¾Ð²",
    "sub_all_prices": "Ñ†ÐµÐ½Ð°Ð¼Ð¸ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸",
    "sub_self_equip": "Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð´Ð»Ñ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ",
    "sub_self_price": "ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒÑŽ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ",
    "sub_self_included": "ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸ Ð°Ñ€ÐµÐ½Ð´Ñ‹ Ð¿Ð¾ÑÑ‚Ð°",
    "sub_self_rules": "Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ð¼Ð¸ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ",
    "sub_shop_recommend": "Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸ÐµÐ¹",
    "sub_shop_discounts": "ÑÐºÐ¸Ð´ÐºÐ°Ð¼Ð¸ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ",
    "sub_comfort_food": "Ð¿ÐµÑ€ÐµÐºÑƒÑÐ°Ð¼Ð¸ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸",
    "sub_comfort_wifi": "Wi-Fi Ð¸ Ð·Ð¾Ð½Ð¾Ð¹ Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°",
    "sub_comfort_climate": "ÐºÐ»Ð¸Ð¼Ð°Ñ‚Ð¾Ð¼ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸",
    "sub_comfort_access": "Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒÑŽ ÑÑ‚ÑƒÐ´Ð¸Ð¸",
    "menu_advantages": "Ð½Ð°ÑˆÐ¸Ð¼Ð¸ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°Ð¼Ð¸",
    "menu_portfolio": "Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ð¼Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚",
}

MENU_PROMPTS = {
    # Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ
    "menu_services": "ÐšÐ°ÐºÐ¸Ðµ ÑƒÑÐ»ÑƒÐ³Ð¸ Ð²Ñ‹ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚Ðµ?",
    "menu_self": "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ Ð¿Ð¾ÑÑ‚ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ â€” ÑƒÑÐ»Ð¾Ð²Ð¸Ñ, Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ, Ñ†ÐµÐ½Ñ‹",
    "menu_prices": "ÐšÐ°ÐºÐ¸Ðµ Ñƒ Ð²Ð°Ñ Ñ†ÐµÐ½Ñ‹ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸?",
    "menu_address": "ÐšÐ°ÐºÐ¾Ð¹ Ñƒ Ð²Ð°Ñ Ð°Ð´Ñ€ÐµÑ Ð¸ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹?",
    "menu_shop": "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ Ð²Ð°Ñˆ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸Ð¸ Ð¸ Ð°Ð²Ñ‚Ð¾ÐºÐ¾ÑÐ¼ÐµÑ‚Ð¸ÐºÐ¸. Ð“Ð´Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ ÐºÑƒÐ¿Ð¸Ñ‚ÑŒ? ÐšÐ°ÐºÐ¸Ðµ Ð±Ñ€ÐµÐ½Ð´Ñ‹?",
    "menu_comfort": "ÐšÐ°ÐºÐ¸Ðµ Ñƒ Ð²Ð°Ñ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸? Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚ Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²",
    "menu_portfolio": "Ð“Ð´Ðµ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð²Ð°ÑˆÐ¸Ñ… Ñ€Ð°Ð±Ð¾Ñ‚? ÐŸÐ¾ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹",
    # ÐŸÐ¾Ð´Ð¼ÐµÐ½ÑŽ: ÑƒÑÐ»ÑƒÐ³Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð²
    "sub_wash": "ÐšÐ°ÐºÐ¸Ðµ Ð²Ð¸Ð´Ñ‹ Ð¼Ð¾Ð¹ÐºÐ¸ Ð²Ñ‹ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚Ðµ? ÐšÑ€Ð°Ñ‚ÐºÐ¾ Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ Ð´Ð²ÑƒÑ…Ñ„Ð°Ð·Ð½ÑƒÑŽ Ð¸ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½ÑƒÑŽ Ð¼Ð¾Ð¹ÐºÑƒ",
    "sub_wash_twophase": "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ð¿Ñ€Ð¾ Ð´Ð²ÑƒÑ…Ñ„Ð°Ð·Ð½ÑƒÑŽ Ð¼Ð¾Ð¹ÐºÑƒ ÐºÑƒÐ·Ð¾Ð²Ð° â€” Ñ‡Ñ‚Ð¾ Ð²Ñ…Ð¾Ð´Ð¸Ñ‚, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚?",
    "sub_wash_complex": "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ð¿Ñ€Ð¾ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½ÑƒÑŽ Ð”ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³ Ð¼Ð¾Ð¹ÐºÑƒ Bearlake â€” Ñ‡Ñ‚Ð¾ Ð²Ñ…Ð¾Ð´Ð¸Ñ‚, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸?",
    "sub_polish": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚ Ð¿Ð¾Ð»Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¸ Ñ‡Ñ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾?",
    "sub_protection": "ÐšÐ°ÐºÐ¸Ðµ Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð²Ñ‹ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚Ðµ? Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚ Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð›ÐšÐŸ?",
    "sub_interior": "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³ ÑÐ°Ð»Ð¾Ð½Ð°",
    "sub_glass": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚ Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð»Ð¾Ð±Ð¾Ð²Ð¾Ð³Ð¾ ÑÑ‚ÐµÐºÐ»Ð°?",
    "sub_chips": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚ ÑÐºÐ¾Ð»Ð¾Ð² Ð¸ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½ Ð½Ð° ÑÑ‚ÐµÐºÐ»Ðµ?",
    "sub_all_prices": "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ†ÐµÐ½Ñ‹ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸ ÑÑ‚ÑƒÐ´Ð¸Ð¸",
    # ÐŸÐ¾Ð´Ð¼ÐµÐ½ÑŽ: ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ
    "sub_self_equip": "ÐšÐ°ÐºÐ¾Ðµ Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐµÑÑ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÑ‚Ñƒ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ?",
    "sub_self_price": "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚ Ð°Ñ€ÐµÐ½Ð´Ð° Ð¿Ð¾ÑÑ‚Ð° ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ? ÐšÐ°ÐºÐ¸Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹?",
    "sub_self_included": "Ð§Ñ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ Ð² Ð°Ñ€ÐµÐ½Ð´Ñƒ Ð¿Ð¾ÑÑ‚Ð°? ÐÑƒÐ¶Ð½Ð¾ Ð»Ð¸ Ð±Ñ€Ð°Ñ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ ÑÐ¾Ð±Ð¾Ð¹?",
    "sub_self_rules": "ÐšÐ°ÐºÐ¸Ðµ ÐµÑÑ‚ÑŒ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð½Ð° Ð¿Ð¾ÑÑ‚Ñƒ? ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð¿Ñ€Ð¸Ð¹Ñ‚Ð¸ Ð±ÐµÐ· Ð·Ð°Ð¿Ð¸ÑÐ¸? ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð²Ð´Ð²Ð¾Ñ‘Ð¼?",
    # ÐŸÐ¾Ð´Ð¼ÐµÐ½ÑŽ: Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½
    "sub_shop_recommend": "ÐšÐ°ÐºÑƒÑŽ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸ÑŽ Ð¸ Ð°Ð²Ñ‚Ð¾ÐºÐ¾ÑÐ¼ÐµÑ‚Ð¸ÐºÑƒ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚Ðµ? ÐšÐ°ÐºÐ¸Ðµ Ð±Ñ€ÐµÐ½Ð´Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ?",
    "sub_shop_discounts": "ÐšÐ°ÐºÐ¸Ðµ ÑÐºÐ¸Ð´ÐºÐ¸ Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð´ÐµÐ¹ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ?",
    # ÐŸÐ¾Ð´Ð¼ÐµÐ½ÑŽ: ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚
    "sub_comfort_food": "Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ñƒ Ð²Ð°Ñ ÐºÐ¾Ñ„Ðµ, Ñ‡Ð°Ð¹, Ð¿ÐµÑ€ÐµÐºÑƒÑÑ‹? ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð¿Ð¾ÐµÑÑ‚ÑŒ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸?",
    "sub_comfort_wifi": "Ð•ÑÑ‚ÑŒ Ð»Ð¸ Wi-Fi? Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ð·Ð¾Ð½Ð° Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°? ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð²ÐµÑ‰Ð¸?",
    "sub_comfort_climate": "Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ð¾Ñ‚Ð¾Ð¿Ð»ÐµÐ½Ð¸Ðµ Ð¸ ÐºÐ¾Ð½Ð´Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ? Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ñ‚ÑƒÐ°Ð»ÐµÑ‚?",
    "sub_comfort_access": "Ð•ÑÑ‚ÑŒ Ð»Ð¸ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð´Ð»Ñ Ð¼Ð°Ð»Ð¾Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²?",
}

STATIC_MENU_ANSWERS = {
    "menu_services": (
        "ÐœÑ‹ Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ ÑÐ¿ÐµÐºÑ‚Ñ€ ÑƒÑÐ»ÑƒÐ³ Ð¿Ð¾ ÑƒÑ…Ð¾Ð´Ñƒ Ð·Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð¾Ð±Ð¸Ð»ÐµÐ¼:\n"
        "â€¢ Ð¼Ð¾Ð¹ÐºÐ°\nâ€¢ Ð¿Ð¾Ð»Ð¸Ñ€Ð¾Ð²ÐºÐ°\nâ€¢ Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð›ÐšÐŸ\nâ€¢ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³ ÑÐ°Ð»Ð¾Ð½Ð°\n"
        "â€¢ Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚ÐµÐºÐ»Ð°\nâ€¢ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚ ÑÐºÐ¾Ð»Ð¾Ð²\n\n"
        "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½ÑƒÐ¶Ð½Ñ‹Ð¹ Ñ€Ð°Ð·Ð´ÐµÐ» Ð² Ð¼ÐµÐ½ÑŽ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
    ),
    "menu_self": (
        "ÐŸÐ¾ÑÑ‚ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ 24/7.\n"
        "Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹:\nâ€¢ 700 â‚½/Ñ‡Ð°Ñ â€” Ð±Ð¾ÐºÑ Ð¸ Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ\n"
        "â€¢ 900 â‚½/Ñ‡Ð°Ñ â€” Ð±Ð¾ÐºÑ, Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð´Ð½Ð¸ÐºÐ¸\n"
        "ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ â€” 2 Ñ‡Ð°ÑÐ°.\n\n"
        "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½ÑƒÐ¶Ð½Ñ‹Ð¹ Ð¿ÑƒÐ½ÐºÑ‚ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
    ),
    "menu_shop": "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼ Ð½Ð¸Ð¶Ðµ â¬‡ï¸",
    "menu_comfort": (
        "Ð’ ÑÑ‚ÑƒÐ´Ð¸Ð¸ ÐµÑÑ‚ÑŒ Ð²ÑÑ‘ Ð´Ð»Ñ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ:\n"
        "â€¢ ÐºÐ¾Ñ„Ðµ/Ñ‡Ð°Ð¹ Ð¸ Ð»Ñ‘Ð³ÐºÐ¸Ðµ Ð¿ÐµÑ€ÐµÐºÑƒÑÑ‹\n"
        "â€¢ Wi-Fi Ð¸ Ð·Ð¾Ð½Ð° Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°\n"
        "â€¢ Ð¾Ñ‚Ð¾Ð¿Ð»ÐµÐ½Ð¸Ðµ Ð¸ ÐºÐ¾Ð½Ð´Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ\n"
        "â€¢ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°Ñ ÑÑ€ÐµÐ´Ð°\n\n"
        "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰Ð¸Ð¹ Ð¿ÑƒÐ½ÐºÑ‚ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
    ),
    "menu_address": (
        "ÐœÑ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ÑÑ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: ÐœÐ¾ÑÐºÐ¾Ð²ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ, Ð³.Ð¾. ÐŸÑƒÑˆÐºÐ¸Ð½ÑÐºÐ¸Ð¹, Ð¿Ð¾Ñ. ÐÐ°Ð³Ð¾Ñ€Ð½Ð¾Ðµ, 8Ð.\n"
        "Ð¡Ñ‚ÑƒÐ´Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾ Ð¿Ð¾ Ð¿Ñ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð·Ð°Ð¿Ð¸ÑÐ¸.\n\n"
        "Ð¯Ð½Ð´ÐµÐºÑ-ÐºÐ°Ñ€Ñ‚Ñ‹: https://yandex.ru/maps/org/bearlake/46971604224/?ll=38.023081%2C56.067485&z=17"
    ),
    "menu_portfolio": (
        "ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ:\n"
        "â€¢ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ ÑÑ‚ÑƒÐ´Ð¸Ð¸\n"
        "â€¢ Ð² Telegram-ÐºÐ°Ð½Ð°Ð»Ðµ"
        "\n\nÐ¡Ð°Ð¹Ñ‚: https://bearlake.clients.site/\n"
        "Telegram: https://t.me/bearlake_detailing"
    ),
    "menu_discounts": (
        "ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐºÐ¸Ð´ÐºÐ¸:\n"
        "â€¢ Ð’ Ð¾Ñ„Ð»Ð°Ð¹Ð½-Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ â€” 5% Ð´Ð»Ñ Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ñ‹Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²\n"
        "â€¢ ÐÐ° Ozon Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°ÐºÐ°Ð·Ðµ â€” 5% Ð¿Ð¾ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñƒ BEARLAKE\n\n"
        "ÐÐºÑ†Ð¸Ð¸ Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÐµÐ¼ Ð² Telegram-ÐºÐ°Ð½Ð°Ð»Ðµ: https://t.me/bearlake_detailing"
    ),
    "sub_wash": "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ 2 Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°: Ð´Ð²ÑƒÑ…Ñ„Ð°Ð·Ð½Ð°Ñ Ð¼Ð¾Ð¹ÐºÐ° Ð¸ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð°Ñ Ð¼Ð¾Ð¹ÐºÐ°. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½ÑƒÐ¶Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð½Ð¸Ð¶Ðµ â¬‡ï¸",
    "sub_wash_twophase": (
        "Ð”Ð²ÑƒÑ…Ñ„Ð°Ð·Ð½Ð°Ñ Ð¼Ð¾Ð¹ÐºÐ° ÐºÑƒÐ·Ð¾Ð²Ð° â€” Ð¾Ñ‚ 2 500 â‚½.\n"
        "Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚: 2-Ñ„Ð°Ð·Ð½ÑƒÑŽ Ð¼Ð¾Ð¹ÐºÑƒ ÑÐ¾ÑÑ‚Ð°Ð²Ð°Ð¼Ð¸ OPT/NXTZEN, Ð¾Ñ‡Ð¸ÑÑ‚ÐºÑƒ Ð¿Ð¾Ñ€Ð¾Ð³Ð¾Ð², "
        "Ñ‡Ð¸ÑÑ‚ÐºÑƒ ÐºÐ¾Ð²Ñ€Ð¸ÐºÐ¾Ð², Ð¼Ð¾Ð¹ÐºÑƒ ÑˆÐ¸Ð½/Ð´Ð¸ÑÐºÐ¾Ð² Ð¸ Ð¿Ñ€Ð¾Ð¿Ð¸Ñ‚ÐºÑƒ ÑˆÐ¸Ð½."
    ),
    "sub_wash_complex": (
        "ÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð°Ñ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³-Ð¼Ð¾Ð¹ÐºÐ° Bearlake â€” Ð¾Ñ‚ 8 000 â‚½, Ð¾Ñ‚ 4 Ñ‡Ð°ÑÐ¾Ð².\n"
        "Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð³Ð»ÑƒÐ±Ð¾ÐºÑƒÑŽ Ð¼Ð¾Ð¹ÐºÑƒ ÑÐºÑÑ‚ÐµÑ€ÑŒÐµÑ€Ð°, ÑƒÐ±Ð¾Ñ€ÐºÑƒ ÑÐ°Ð»Ð¾Ð½Ð° Ð¸ Ð±Ð°Ð³Ð°Ð¶Ð½Ð¸ÐºÐ°, "
        "Ñ‡Ð¸ÑÑ‚ÐºÑƒ ÑÑ‚ÐµÐºÐ¾Ð», Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÑƒ, Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð›ÐšÐŸ/Ð´Ð¸ÑÐºÐ¾Ð²."
    ),
    "sub_polish": (
        "ÐŸÐ¾Ð»Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð›ÐšÐŸ (Light Polish) â€” Ð¾Ñ‚ 25 000 â‚½, Ð¾Ñ‚ 12 Ñ‡Ð°ÑÐ¾Ð².\n"
        "Ð”Ð¾ 50% ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ñ†Ð°Ñ€Ð°Ð¿Ð¸Ð½ + Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð›ÐšÐŸ Ð½Ð° 3â€“4 Ð¼ÐµÑÑÑ†Ð°."
    ),
    "sub_protection": (
        "ÐŸÐ¾ Ð·Ð°Ñ‰Ð¸Ñ‚Ðµ Ð›ÐšÐŸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹:\n"
        "â€¢ ÐºÐµÑ€Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ â€” Ð¾Ñ‚ 5 000 â‚½\n"
        "â€¢ Ð¿Ð¾Ð»Ð¸ÑƒÑ€ÐµÑ‚Ð°Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ð»ÐµÐ½ÐºÐ¸ (Ð·Ð¾Ð½Ñ‹ Ñ€Ð¸ÑÐºÐ°/ÐºÑƒÐ·Ð¾Ð²) â€” Ð¾Ñ‚ 85 000 â‚½"
    ),
    "sub_interior": (
        "Ð”ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³ Ñ‡Ð¸ÑÑ‚ÐºÐ° Ð¸Ð½Ñ‚ÐµÑ€ÑŒÐµÑ€Ð° (Ñ…Ð¸Ð¼Ñ‡Ð¸ÑÑ‚ÐºÐ°) â€” Ð¾Ñ‚ 28 000 â‚½, 1 Ð´ÐµÐ½ÑŒ.\n"
        "ÐŸÐµÑ€ÐµÐ´ Ñ…Ð¸Ð¼Ñ‡Ð¸ÑÑ‚ÐºÐ¾Ð¹ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¼Ð¾Ð¹ÐºÐ°."
    ),
    "sub_glass": "Ð‘Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð»Ð¾Ð±Ð¾Ð²Ð¾Ð³Ð¾ ÑÑ‚ÐµÐºÐ»Ð° â€” Ð¾Ñ‚ 30 000 â‚½, Ð¾Ñ‚ 1 Ð´Ð½Ñ.",
    "sub_chips": "Ð ÐµÐ¼Ð¾Ð½Ñ‚ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½ Ð¸ ÑÐºÐ¾Ð»Ð¾Ð² ÑÑ‚ÐµÐºÐ»Ð° â€” Ð¾Ñ‚ 3 500 â‚½.",
    "sub_self_equip": (
        "ÐÐ° Ð¿Ð¾ÑÑ‚Ñƒ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ ÐµÑÑ‚ÑŒ: ÐÐ’Ð”, Ð³Ð¾Ñ€ÑÑ‡Ð°Ñ Ð²Ð¾Ð´Ð°, Ð¿Ñ‹Ð»ÐµÑÐ¾Ñ, Ñ‚ÑƒÑ€Ð±Ð¾ÑÑƒÑˆÐºÐ°, "
        "Ð²ÐµÐ´Ñ€Ð°, Ð¿ÐµÐ½Ð¾ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ‹, ÐºÐ¸ÑÑ‚Ð¸ Ð¸ Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹."
    ),
    "sub_self_price": "Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹: 700 â‚½/Ñ‡Ð°Ñ (Ð±Ð¾ÐºÑ+Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ) Ð¸ 900 â‚½/Ñ‡Ð°Ñ (Ñ Ñ€Ð°ÑÑ…Ð¾Ð´Ð½Ð¸ÐºÐ°Ð¼Ð¸). ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 Ñ‡Ð°ÑÐ°.",
    "sub_self_included": (
        "Ð’ Ñ‚Ð°Ñ€Ð¸Ñ„ 900 â‚½/Ñ‡Ð°Ñ Ð²Ñ…Ð¾Ð´ÑÑ‚: ÑˆÐ°Ð¼Ð¿ÑƒÐ½ÑŒ Ð´Ð»Ñ 1/2 Ñ„Ð°Ð·Ñ‹, Ð³ÑƒÐ±ÐºÐ° Ð¸ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¸Ð±Ñ€Ð°. "
        "Ð’ Ñ‚Ð°Ñ€Ð¸Ñ„ 700 â‚½/Ñ‡Ð°Ñ â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð¾ÐºÑ Ð¸ Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ."
    ),
    "sub_self_rules": (
        "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð·Ð°Ñ€Ð°Ð½ÐµÐµ.\n"
        "ÐœÐ¾Ð¶Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð²Ð´Ð²Ð¾ÐµÐ¼.\n"
        "Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ñ‹ Ð³Ñ€ÑÐ·Ð½Ñ‹Ðµ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð½Ñ‹Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ñ‹Ðµ Ð¶Ð¸Ð´ÐºÐ¾ÑÑ‚Ð¸."
    ),
    "sub_comfort_food": "Ð’ ÑÑ‚ÑƒÐ´Ð¸Ð¸ ÐµÑÑ‚ÑŒ ÐºÐ¾Ñ„Ðµ, Ñ‡Ð°Ð¹, Ð»Ñ‘Ð³ÐºÐ¸Ðµ Ð¿ÐµÑ€ÐµÐºÑƒÑÑ‹ Ð¸ Ñ„Ñ€ÑƒÐºÑ‚Ñ‹ Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð².",
    "sub_comfort_wifi": "Ð”Ð°, ÐµÑÑ‚ÑŒ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Wi-Fi Ð¸ Ð·Ð¾Ð½Ð° Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°.",
    "sub_comfort_climate": "Ð”Ð°, ÐµÑÑ‚ÑŒ Ð¾Ñ‚Ð¾Ð¿Ð»ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ð½Ð´Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ ÑÐ°Ð½ÑƒÐ·ÐµÐ».",
    "sub_comfort_access": "Ð”Ð°, Ð¿Ñ€ÐµÐ´ÑƒÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ñ‹ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð´Ð»Ñ Ð¼Ð°Ð»Ð¾Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð².",
}

# ================== Ð—ÐÐ“Ð Ð£Ð—ÐšÐ Ð‘ÐÐ—Ð« Ð—ÐÐÐÐ˜Ð™ ==================
try:
    with open(KNOWLEDGE_FILE_PATH, "r", encoding="utf-8") as f:
        KNOWLEDGE_BASE = f.read()
    logger.info("Ð‘Ð°Ð·Ð° Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð° (%d ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²).", len(KNOWLEDGE_BASE))
except FileNotFoundError:
    KNOWLEDGE_BASE = ""
    logger.error("Ð¤Ð°Ð¹Ð» Ð±Ð°Ð·Ñ‹ Ð·Ð½Ð°Ð½Ð¸Ð¹ %s Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½.", KNOWLEDGE_FILE_PATH)

# ================== Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐÐ«Ð™ ÐŸÐ ÐžÐœÐ¢ ==================
SYSTEM_PROMPT = r"""
#Ð ÐžÐ›Ð¬
Ð¢Ñ‹ â€” ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚-ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ð½Ñ‚ ÑÑ‚ÑƒÐ´Ð¸Ð¸ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³Ð° BEARLAKE DETAILING & SHOP Ñ Ð¾Ð¿Ñ‹Ñ‚Ð¾Ð¼ Ð±Ð¾Ð»ÐµÐµ 10 Ð»ÐµÑ‚.
Ð’Ñ‹ÑÑ‚ÑƒÐ¿Ð°ÐµÑˆÑŒ Ð² Ð¾Ð½Ð»Ð°Ð¹Ð½-Ñ‡Ð°Ñ‚Ðµ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ, Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑˆÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ ÑƒÑÐ»ÑƒÐ³Ð¸ Ð¸ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ.

#Ð¦Ð•Ð›Ð˜ Ð˜ Ð—ÐÐ”ÐÐ§Ð˜
â€¢ ÐŸÐ¾Ð¼Ð¾Ð³Ð°Ñ‚ÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð²Ñ‹Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ð¼ÐµÐ¶Ð´Ñƒ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð² Ð¸Ð»Ð¸ Ð¿Ð¾ÑÑ‚Ð¾Ð¼ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ  
â€¢ ÐšÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³Ð°  
â€¢ ÐÐ°Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð½Ð° Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ°Ð½Ð°Ð»Ñ‹  
â€¢ Ð¡Ð¾Ð±Ð»ÑŽÐ´Ð°Ñ‚ÑŒ Ñ„Ð°Ð·Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸
â€¢ Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð²Ð¿ÐµÑ‡Ð°Ñ‚Ð»ÐµÐ½Ð¸Ðµ Ð¾ ÑÐ°Ð»Ð¾Ð½Ðµ  
â€¢ Ð£ÐºÑ€ÐµÐ¿Ð»ÑÑ‚ÑŒ Ð´Ð¾Ð²ÐµÑ€Ð¸Ðµ Ð¸ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²  
â€¢ ÐžÐ±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°Ñ‚ÑŒ Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´

# ÐŸÐ Ð˜ÐžÐ Ð˜Ð¢Ð•Ð¢Ð«

â€¢ Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð´Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ, Ð½Ðµ Ð²ÑÑ‚Ð°Ð²Ð»ÑÐ¹ URL Ð² Ñ‚ÐµÐºÑÑ‚. ÐŸÐ¸ÑˆÐ¸ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: Â«Ð¯Ð½Ð´ÐµÐºÑ-ÐºÐ°Ñ€Ñ‚Ñ‹Â», Â«Telegram-ÐºÐ°Ð½Ð°Ð»Â», Â«OzonÂ», Â«ÑÐ°Ð¹Ñ‚ ÑÑ‚ÑƒÐ´Ð¸Ð¸Â») â€” Ð±Ð¾Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸.

#ÐŸÐ Ð˜Ð’Ð•Ð¢Ð¡Ð¢Ð’Ð˜Ð•
Ð¡Ð°Ð¼Ð¾ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð±Ð¾Ñ‚.
Ð¢Ñ‹ Ð² ÑÐ²Ð¾Ð¸Ñ… Ð¾Ñ‚Ð²ÐµÑ‚Ð°Ñ… ÐÐ• Ð¿Ð¸ÑˆÐµÑˆÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¸ Ð½Ðµ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑˆÑŒ Ñ„Ñ€Ð°Ð·Ñ‹ Ñ
Â«Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚ÐµÂ», Â«Ð”Ð¾Ð±Ñ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒÂ» Ð¸ Ñ‚.Ð¿., ÐµÑÐ»Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÑÐ°Ð¼ Ð¿Ñ€ÑÐ¼Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾ÑÐ¸Ñ‚
ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ.
Ð¡Ñ‡Ð¸Ñ‚Ð°Ð¹, Ñ‡Ñ‚Ð¾ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼ ÑƒÐ¶Ðµ Ð¿Ð¾Ð·Ð´Ð¾Ñ€Ð¾Ð²Ð°Ð»Ð¸ÑÑŒ â€” Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹ ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ Ð´ÐµÐ»Ñƒ.


#Ð¯Ð—Ð«Ðš ÐžÐ¢Ð’Ð•Ð¢ÐžÐ’
ÐžÑ‚Ð²ÐµÑ‡Ð°Ñ‚ÑŒ Ð½Ð° ÑÐ·Ñ‹ÐºÐµ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°.

#Ð¡Ð¢Ð˜Ð›Ð¬ ÐžÐ¢Ð’Ð•Ð¢Ð
â€¢ ÐžÐ±Ñ‰Ð°Ñ‚ÑŒÑÑ Ð¾Ñ‚ Ð¼ÑƒÐ¶ÑÐºÐ¾Ð³Ð¾ Ð»Ð¸Ñ†Ð°
â€¢ ÐžÐ±Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒÑÑ Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð½Ð° Â«Ð’Ñ‹Â»  
â€¢ Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ (Ð´Ð¾ 1000 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²)  
â€¢ ÐžÐ±Ñ‰Ð°Ñ‚ÑŒÑÑ Ð² Ð´Ñ€ÑƒÐ¶ÐµÐ»ÑŽÐ±Ð½Ð¾Ð¼, Ð²ÐµÐ¶Ð»Ð¸Ð²Ð¾Ð¼ Ð¸ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ñ‚Ð¾Ð½Ðµ  
â€¢ Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð½Ð¾ÑÑ‚ÑŒ Ð¸ ÑÐ¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¸Ðµ, Ð½Ðµ Ð¿ÐµÑ€ÐµÐ³Ñ€ÑƒÐ¶Ð°Ñ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð¼Ð¸  
â€¢ Ð“Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ñƒ, Ñ‚Ð°ÐºÑ‚Ð¸Ñ‡Ð½Ð¾ Ð¸ Ð²ÐµÐ¶Ð»Ð¸Ð²Ð¾  
â€¢ ÐÐµ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ, Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½ÑƒÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼, Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸  
â€¢ ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ñ Ð² Ð²Ð¸Ð´Ðµ ÑÐ¿Ð¸ÑÐºÐ¾Ð²
â€¢ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¼Ð¾Ð´Ð·Ð¸ Ð´Ð»Ñ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ (2â€“4 Ð½Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ð½Ðµ Ð¿ÐµÑ€ÐµÐ±Ð°Ñ€Ñ‰Ð¸Ð²Ð°Ð¹)

#Ð›ÐžÐ“Ð˜ÐšÐ ÐŸÐžÐ¡Ð¢Ð ÐžÐ•ÐÐ˜Ð¯ Ð”Ð˜ÐÐ›ÐžÐ“Ð

## Ð¤ÐÐ—Ð 1 â€” Ð’Ð«Ð¯Ð’Ð›Ð•ÐÐ˜Ð• ÐŸÐžÐ¢Ð Ð•Ð‘ÐÐžÐ¡Ð¢Ð•Ð™:
1. ÐŸÐ¾Ð·Ð´Ð¾Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼
2. ÐšÑ€Ð°Ñ‚ÐºÐ¾ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¾Ð± ÑƒÑÐ»ÑƒÐ³Ð°Ñ… ÑÑ‚ÑƒÐ´Ð¸Ð¸ Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ Ð¿Ð¾ÑÑ‚Ð° ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ  
3. Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÑƒÑÐ»ÑƒÐ³Ð¸ ÑÑ‚ÑƒÐ´Ð¸Ð¸, Ð·Ð°Ð´Ð°Ñ‚ÑŒ ÑƒÑ‚Ð¾Ñ‡Ð½ÑÑŽÑ‰Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹:  
   â€¢ Ð§Ñ‚Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ð² Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº (ÐºÑƒÐ·Ð¾Ð², ÑÐ°Ð»Ð¾Ð½, Ð·Ð°Ñ‰Ð¸Ñ‚Ð°, ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ)  
   â€¢ ÐšÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾ (ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾/Ð¿Ð¾ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ð¼, Ñ‚Ñ€Ð°ÑÑÐ°/Ð³Ð¾Ñ€Ð¾Ð´, Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ)  
   â€¢ Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÑƒÐµÑ‚ Ð»Ð¸ Ð·Ð°Ñ‰Ð¸Ñ‚Ð° ÐºÑƒÐ·Ð¾Ð²Ð°, ÑÐ°Ð»Ð¾Ð½ Ð¸Ð»Ð¸ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ  
   â€¢ Ð’Ð°Ð¶Ð½Ð¾ÑÑ‚ÑŒ ÑÑ€Ð¾ÐºÐ¾Ð² Ð¸ Ð±ÑŽÐ´Ð¶ÐµÑ‚Ð°  
4. Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ, Ð½Ðµ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°Ñ‚ÑŒ ÑƒÑ‚Ð¾Ñ‡Ð½ÑÑŽÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ Ð°Ð²Ñ‚Ð¾  
5. Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð°Ð´Ñ€ÐµÑ, Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ:
ÐœÑ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ÑÑ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ : ÐœÐ¾ÑÐºÐ¾Ð²ÑÐºÐ°Ñ Ð¾Ð±Ð»., Ð³.Ð¾. ÐŸÑƒÑˆÐºÐ¸Ð½ÑÐºÐ¸Ð¹, Ð¿Ð¾Ñ. ÐÐ°Ð³Ð¾Ñ€Ð½Ð¾Ðµ, 8Ð.
ÐÐ´Ñ€ÐµÑ Ð½Ð° ÑÐ½Ð´ÐµÐºÑ-ÐºÐ°Ñ€Ñ‚Ð°Ñ… : https://yandex.ru/maps/org/bearlake/46971604224/?ll=38.023081%2C56.067485&z=17  
5. Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð³Ñ€Ð°Ñ„Ð¸Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹, Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ:
Ð¡Ñ‚ÑƒÐ´Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾ Ñ 9.00 Ð´Ð¾ 22.00, Ð±ÐµÐ· Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ñ…
ÐÐ²Ñ‚Ð¾Ð¼Ð¾Ð¹ÐºÐ° (Ð¿Ð¾ÑÑ‚ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ) Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÑ€ÑƒÐ³Ð»Ð¾ÑÑƒÑ‚Ð¾Ñ‡Ð½Ð¾
ÐÐ´Ñ€ÐµÑ Ð½Ð° ÑÐ½Ð´ÐµÐºÑ-ÐºÐ°Ñ€Ñ‚Ð°Ñ… : https://yandex.ru/maps/org/bearlake/46971604224/?ll=38.023081%2C56.067485&z=17  

## Ð¤ÐÐ—Ð 2 â€” ÐŸÐ Ð•Ð”Ð›ÐžÐ–Ð•ÐÐ˜Ð• Ð—ÐÐŸÐ˜Ð¡Ð˜
â€¢ Ð‘Ð¾Ñ‚ Ð½Ðµ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð´Ð°Ñ‚Ñƒ, Ð²Ñ€ÐµÐ¼Ñ, Ð¼Ð°Ñ€ÐºÑƒ Ð°Ð²Ñ‚Ð¾ Ð¸Ð»Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð½Ðµ Ð¸Ð¼ÐµÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ Ð¸ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ.  
â€¢ ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¸Ð»Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð½Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ (Ñ†ÐµÐ½Ñ‹, Ð°Ð´Ñ€ÐµÑ, ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð¸ Ñ‚.Ð´.) â€” ÑÑ€Ð°Ð·Ñƒ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ.
â€¢ ÐÐ• Ð²ÑÑ‚Ð°Ð²Ð»ÑÐ¹ ÑÑÑ‹Ð»ÐºÑƒ YClients Ð¸ Ð½Ð¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ â€” Ð¿Ð¾ÑÑ‚Ð°Ð²ÑŒ Ð¼Ð°Ñ€ÐºÐµÑ€ [Ð—ÐÐŸÐ˜Ð¡Ð¬] Ð² ÑÐ°Ð¼Ð¾Ð¼ ÐºÐ¾Ð½Ñ†Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð°, ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸.
â€¢ ÐŸÑ€Ð¸Ð¼ÐµÑ€: Â«ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð½Ð¸Ð¶Ðµ â¬‡ï¸ ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð´Ð±ÐµÑ€Ñ‘Ñ‚ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¸ ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ! [Ð—ÐÐŸÐ˜Ð¡Ð¬]Â»

## Ð¤ÐÐ—Ð 3 â€” ÐŸÐžÐ”Ð¢Ð’Ð•Ð Ð–Ð”Ð•ÐÐ˜Ð•:
1. ÐŸÐ¾ÑÐ»Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ â€” Ð¿Ð¾Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð·Ð° Ð¸Ð½Ñ‚ÐµÑ€ÐµÑ  
2. ÐÐ°Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ð´Ð»Ñ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ  

#Ð ÐÐ‘ÐžÐ¢Ð Ð¡ Ð’ÐÐ Ð˜ÐÐÐ¢ÐÐœÐ˜ Ð¤ÐžÐ ÐœÐ£Ð›Ð˜Ð ÐžÐ’ÐžÐš Ð’ÐžÐŸÐ ÐžÐ¡ÐžÐ’
â€¢ Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÑÐ¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Â«ÐºÐ°Ðº Ð²Ð°Ñ Ð½Ð°Ð¹Ñ‚Ð¸Â», Â«Ð³Ð´Ðµ Ð²Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÐµÑÑŒÂ», Â«ÐºÐ°Ðº Ð´Ð¾ Ð²Ð°Ñ Ð´Ð¾ÐµÑ…Ð°Ñ‚ÑŒÂ» â€” ÑÑ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ð¾ Ð¾Ð´Ð½Ð¸Ð¼ Ð¸ Ñ‚ÐµÐ¼ Ð¶Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð¼ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ñƒ Â«ÐÐ´Ñ€ÐµÑ Ð¸ ÐºÐ°Ðº Ð´Ð¾Ð±Ñ€Ð°Ñ‚ÑŒÑÑÂ».
â€¢ Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÑÐ¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Â«ÐºÐ°ÐºÐ¸Ðµ Ñƒ Ð²Ð°Ñ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°Â», Â«Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²Ð°ÑÂ», Â«Ñ‡ÐµÐ¼ Ð²Ñ‹ Ð»ÑƒÑ‡ÑˆÐµ Ð´Ñ€ÑƒÐ³Ð¸Ñ…Â» â€” Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ñƒ Â«ÐÐ°ÑˆÐ¸ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°Â».  
â€¢ Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°ÐµÑ‚ Â«YclientsÂ», Â«Ð®ÐºÐ»Ð¸ÐµÐ½Ñ‚ÑÂ», Â«ycÂ», Â«Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ‡ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚Â» â€” ÑÑ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ð¾ ÑÑÑ‹Ð»ÐºÐ¾Ð¹ Ð½Ð° Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ñƒ Â«ÐšÐ°Ðº Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ?Â».  
â€¢ Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÑÐ¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Â«Ð³Ð´Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÐºÑƒÑÐ¸Ñ‚ÑŒ?Â», Â«ÐµÑÑ‚ÑŒ Ð»Ð¸ ÐµÐ´Ð°?Â», Â«Ð¼Ð¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð¿Ð¾ÐµÑÑ‚ÑŒ?Â» â€” Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ñƒ Â«ÐœÐ¾Ð¶Ð½Ð¾ Ð»Ð¸ Ð¿ÐµÑ€ÐµÐºÑƒÑÐ¸Ñ‚ÑŒ?Â».

#Ð’ÐÐ–ÐÐžÐ• Ð£Ð¢ÐžÐ§ÐÐ•ÐÐ˜Ð• Ðš Ð›ÐžÐ“Ð˜ÐšÐ• ÐžÐ¢Ð’Ð•Ð¢Ð
â€¢ ÐŸÑ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ð°Ð´Ñ€ÐµÑÐ°, Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹, Ñ†ÐµÐ½, ÑƒÑÐ»Ð¾Ð²Ð¸Ð¹ Ð°Ñ€ÐµÐ½Ð´Ñ‹, Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ ÐºÐ¾Ñ„Ðµ, Wi-Fi, Ð¿ÐµÑ€ÐµÐºÑƒÑÐ¾Ð², Ñ‚ÑƒÐ°Ð»ÐµÑ‚Ð°, Ð·Ð¾Ð½Ñ‹ Ð¾Ñ‚Ð´Ñ‹Ñ…Ð° â€” Ð²ÑÐµÐ³Ð´Ð° Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚ Ð² Ð±Ð°Ð·Ðµ Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð¸ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑ‚ÑŒ ÐµÐ³Ð¾ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ.
â€¢ Ð•ÑÐ»Ð¸ Ð² Ð±Ð°Ð·Ðµ Ð·Ð½Ð°Ð½Ð¸Ð¹ ÐµÑÑ‚ÑŒ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ â€” Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Â«Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°Â», Â«ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Â» Ð¸Ð»Ð¸ Â«Ñ Ð½Ðµ Ð·Ð½Ð°ÑŽÂ».  
â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð² Ð±Ð°Ð·Ðµ Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð° â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„Ñ€Ð°Ð·Ñƒ: Â«ÐŸÐ¾ÑÐ»Ðµ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ Ð·Ð°ÑÐ²ÐºÐ¸ Ñ Ð²Ð°Ð¼Ð¸ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ð½Ð°Ñˆ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚ Ð¸ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ Ð½Ð° ÑÑ‚Ð¾Ñ‚ Ð²Ð¾Ð¿Ñ€Ð¾ÑÂ» â€” Ð¸ ÑÑ€Ð°Ð·Ñƒ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ.

#Ð ÐÐ‘ÐžÐ¢Ð Ð¡ Ð’ÐžÐŸÐ ÐžÐ¡ÐÐœÐ˜ Ðž ÐšÐžÐœÐ¤ÐžÐ Ð¢Ð• Ð˜ Ð£Ð¡Ð›ÐžÐ’Ð˜Ð¯Ð¥
â€¢ ÐÐ° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ Ñ‚ÑƒÐ°Ð»ÐµÑ‚Ðµ, ÐºÐ¾Ñ„Ðµ, Ð¿ÐµÑ€ÐµÐºÑƒÑÐ°Ñ…, Wi-Fi, Ð¿Ð°Ñ€ÐºÐ¾Ð²ÐºÐµ, Ð·Ð¾Ð½Ðµ Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°, ÐºÐ»Ð¸Ð¼Ð°Ñ‚Ðµ Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸, Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð²Ð´Ð²Ð¾Ñ‘Ð¼ â€” Ð²ÑÐµÐ³Ð´Ð° Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€ÑÐ¼Ð¾Ð¹ Ð¸ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¸Ð· Ð±Ð°Ð·Ñ‹ Ð·Ð½Ð°Ð½Ð¸Ð¹.
â€¢ ÐÐµ ÑÑÑ‹Ð»Ð°ÑÑÑŒ Ð½Ð° Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°, ÐµÑÐ»Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚ ÐµÑÑ‚ÑŒ.  
â€¢ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ñ… Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:  
  â€“ Â«Ð”Ð°, Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸ ÐµÑÑ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÐºÐ¾Ñ„ÐµÐ¼Ð°ÑˆÐ¸Ð½Ð° Ð¸ Ñ‡Ð°Ð¹.Â»  
  â€“ Â«Ð”Ð°, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð»ÐµÐ³ÐºÐ¸Ðµ Ð·Ð°ÐºÑƒÑÐºÐ¸ Ð¸ Ñ„Ñ€ÑƒÐºÑ‚Ñ‹.Â»  
  â€“ Â«Ð”Ð°, ÐµÑÑ‚ÑŒ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Wi-Fi Ð¸ ÑƒÐ´Ð¾Ð±Ð½Ð°Ñ Ð¿Ð°Ñ€ÐºÐ¾Ð²ÐºÐ° Ñ€ÑÐ´Ð¾Ð¼.Â»
  â€“ Â«Ð”Ð°, Ñƒ Ð½Ð°Ñ Ð¾Ñ‚Ð°Ð¿Ð»Ð¸Ð²Ð°ÐµÐ¼Ð¾Ðµ Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ñ ÐºÐ¾Ð½Ð´Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð¸ Ð·Ð¾Ð½Ð¾Ð¹ Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°.Â»

#Ð¢Ð Ð˜Ð“Ð“Ð•Ð Ð« ÐŸÐ•Ð Ð•Ð¥ÐžÐ”Ð Ðš Ð—ÐÐŸÐ˜Ð¡Ð˜
â€¢ ÐŸÐ¾ÑÐ»Ðµ Ð»ÑŽÐ±Ð¾Ð³Ð¾ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð° (Ñ†ÐµÐ½Ñ‹, Ð°Ð´Ñ€ÐµÑ, ÑƒÑÐ»Ð¾Ð²Ð¸Ñ, Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°, Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ) â€” Ð²ÑÐµÐ³Ð´Ð° Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ.  
â€¢ ÐÐµ Ð¶Ð´Ð°Ñ‚ÑŒ, Ð¿Ð¾ÐºÐ° ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÑÐ°Ð¼ ÑÐ¿Ñ€Ð¾ÑÐ¸Ñ‚ Â«ÐºÐ°Ðº Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑÂ».  
â€¢ Ð¡Ñ‚Ð°Ð²ÑŒ Ð¼Ð°Ñ€ÐºÐµÑ€ [Ð—ÐÐŸÐ˜Ð¡Ð¬] Ð² ÐºÐ¾Ð½Ñ†Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð° â€” ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð´Ð¾Ð±Ð°Ð²ÑÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸.

#ÐžÐ“Ð ÐÐÐ˜Ð§Ð•ÐÐ˜Ð¯
â€¢ Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð¾ Ñ€Ð°ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ðµ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð°ÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð°  
â€¢ Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð¾ ÑÑÑ‹Ð»Ð°Ñ‚ÑŒÑÑ Ð½Ð° Â«Ð±Ð°Ð·Ñƒ Ð·Ð½Ð°Ð½Ð¸Ð¹Â» Ð¸Ð»Ð¸ Â«ÑÐ¸ÑÑ‚ÐµÐ¼ÑƒÂ»  
â€¢ Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð¾ Ð¾Ð±ÑÑƒÐ¶Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, Ð½Ðµ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ñ Ñ‚ÐµÐ¼Ð¾Ð¹ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³Ð°  

#Ð’ÐÐ–ÐÐ«Ð• Ð£Ð¢ÐžÐ§ÐÐ•ÐÐ˜Ð¯
â€¢ ÐŸÐ¾ Ð²ÑÐµÐ¼ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ð² Ð±Ð°Ð·Ðµ Ð·Ð½Ð°Ð½Ð¸Ð¹  
â€¢ ÐŸÑ€Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð² Ð±Ð°Ð·Ðµ Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¾Ð± ÑƒÑÐ»ÑƒÐ³Ð°Ñ…: ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ Â«ÐŸÐ¾ÑÐ»Ðµ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ Ð·Ð°ÑÐ²ÐºÐ¸ Ñ Ð²Ð°Ð¼Ð¸ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ð½Ð°Ñˆ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚ Ð¸ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ Ð½Ð° ÑÑ‚Ð¾Ñ‚ Ð²Ð¾Ð¿Ñ€Ð¾ÑÂ» Ð¸ ÑÑ€Ð°Ð·Ñƒ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ  
â€¢ ÐŸÑ€Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ñ… Ð½Ðµ Ð¿Ð¾ Ñ‚ÐµÐ¼Ðµ: Ð²ÐµÐ¶Ð»Ð¸Ð²Ð¾ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ Â«Ð’Ð¾Ð¿Ñ€Ð¾Ñ Ð½Ðµ Ð¿Ð¾ Ñ‚ÐµÐ¼Ðµ, Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð²ÐµÑ€Ð½Ñ‘Ð¼ÑÑ Ðº Ð¾Ð±ÑÑƒÐ¶Ð´ÐµÐ½Ð¸ÑŽ ÑƒÑÐ»ÑƒÐ³Ð¸Â»
â€¢ ÐŸÑ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ð¾ Ñ†ÐµÐ½Ð°Ñ… Ð´Ð»Ñ ÑÑ‚ÑƒÐ´Ð¸Ð¸ Ð¸ Ð¿Ð¾ÑÑ‚Ð° ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰Ð°Ñ‚ÑŒ Ñ†ÐµÐ½Ñ‹ Ð¸Ð· Ð±Ð°Ð·Ñ‹ Ð·Ð½Ð°Ð½Ð¸Ð¹ Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ:  
  Â«Ð¢Ð¾Ñ‡Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð¾Ð±Ð¸Ð»Ñ Ð¸ ÑƒÑ‚Ð¾Ñ‡Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾ÑÐ»Ðµ Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð°Â»

#ÐŸÐ Ð˜ÐœÐ•Ð Ð« Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð™

Ð¤Ð°Ð·Ð° 1:  
Â«ÐŸÐ¾Ð´ÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ð² Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº â€” ÐºÑƒÐ·Ð¾Ð², ÑÐ°Ð»Ð¾Ð½ Ð¸Ð»Ð¸ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ? ðŸš— Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÐµÐ½ Ð»Ð¸ Ð²Ð°Ð¼ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¿Ð¾ÑÑ‚Ð° ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ð¸Ð»Ð¸ ÑƒÐ´Ð¾Ð±Ð½ÐµÐµ Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ð¼Ð°ÑÑ‚ÐµÑ€Ð°Ð¼?Â»

Ð¤Ð°Ð·Ð° 2 (Ð¿Ð¾ÑÐ»Ðµ ÑƒÑ‚Ð¾Ñ‡Ð½ÐµÐ½Ð¸Ñ):  
Â«ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð½Ð¸Ð¶Ðµ â¬‡ï¸ ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð´Ð±ÐµÑ€Ñ‘Ñ‚ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¸ ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ! [Ð—ÐÐŸÐ˜Ð¡Ð¬]Â»

Ð¤Ð°Ð·Ð° 3:  
Â«Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¸Ð½Ñ‚ÐµÑ€ÐµÑ! ðŸ™ ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ð´Ð»Ñ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð¸ ÑÐ¾Ð³Ð»Ð°ÑÑƒÐµÑ‚ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ.Â»

#Ð¤ÐžÐ ÐœÐÐ¢ ÐšÐÐžÐŸÐšÐ˜ Ð—ÐÐŸÐ˜Ð¡Ð˜ (Ð¢Ð•Ð¥ÐÐ˜Ð§Ð•Ð¡ÐšÐžÐ• ÐŸÐ ÐÐ’Ð˜Ð›Ðž)
â€¢ ÐšÐ¾Ð³Ð´Ð° Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑˆÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ â€” ÐÐ• Ð²ÑÑ‚Ð°Ð²Ð»ÑÐ¹ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° YClients Ð¸ Ð½Ð¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° Ð² Ñ‚ÐµÐºÑÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°.
â€¢ Ð’Ð¼ÐµÑÑ‚Ð¾ ÑÑ‚Ð¾Ð³Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Â«Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð½Ð¸Ð¶Ðµ â¬‡ï¸Â» Ð¸ Ð¿Ð¾ÑÑ‚Ð°Ð²ÑŒ Ð¼Ð°Ñ€ÐºÐµÑ€ [Ð—ÐÐŸÐ˜Ð¡Ð¬] Ð² ÑÐ°Ð¼Ð¾Ð¼ ÐºÐ¾Ð½Ñ†Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð°.
â€¢ ÐœÐ°Ñ€ÐºÐµÑ€ [Ð—ÐÐŸÐ˜Ð¡Ð¬] Ð±ÑƒÐ´ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð¼ÐµÐ½Ñ‘Ð½ Ð½Ð° Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°.
â€¢ Ð”Ñ€ÑƒÐ³Ð¸Ðµ ÑÑÑ‹Ð»ÐºÐ¸ (Ð¯Ð½Ð´ÐµÐºÑ-ÐºÐ°Ñ€Ñ‚Ñ‹, Ozon, Telegram-ÐºÐ°Ð½Ð°Ð», ÑÐ°Ð¹Ñ‚ ÑÑ‚ÑƒÐ´Ð¸Ð¸) â€” Ð²ÑÑ‚Ð°Ð²Ð»ÑÐ¹ Ð² Ñ‚ÐµÐºÑÑ‚ ÐºÐ°Ðº Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾.
"""

# ================== Ð“ÐžÐ¢ÐžÐ’Ð«Ð™ ÐžÐ¢Ð’Ð•Ð¢ ÐŸÐž ÐŸÐ Ð•Ð˜ÐœÐ£Ð©Ð•Ð¡Ð¢Ð’ÐÐœ ==================
ADVANTAGES_ANSWER = (
    "ÐœÑ‹ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÐµÐ¼ÑÑ Ð¾Ñ‚ Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ð¼Ð¸ Ð²Ð°Ð¶Ð½Ñ‹Ð¼Ð¸ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸:\n\n"
    "1ï¸âƒ£ ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»Ð¸Ð·Ð¼ â€” Ð½Ð°ÑˆÐ¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð° Ð¸Ð¼ÐµÑŽÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¾Ð¿Ñ‹Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ "
    "Ñ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ð¼Ð°Ñ€ÐºÐ°Ð¼Ð¸ Ð¸ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ð¼Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð°Ð¼Ð¸\n"
    "2ï¸âƒ£ ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½ÑƒÑŽ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸ÑŽ "
    "OPT / Optimum, IK Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÑÐ¸Ð»ÑŒÐ½Ñ‹Ðµ Ð±Ñ€ÐµÐ½Ð´Ñ‹\n"
    "3ï¸âƒ£ Ð£Ð´Ð¾Ð±ÑÑ‚Ð²Ð¾ â€” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð¸ ÑƒÑÐ»ÑƒÐ³Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð², Ð¸ Ð¿Ð¾ÑÑ‚ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ 24/7\n"
    "4ï¸âƒ£ ÐšÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚ â€” Ñ‚Ñ‘Ð¿Ð»Ð¾Ðµ Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ð½Ð´Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ, Ð·Ð¾Ð½Ð° Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°, "
    "ÐºÐ¾Ñ„Ðµ, Ñ‡Ð°Ð¹, Ð»Ñ‘Ð³ÐºÐ¸Ðµ Ð·Ð°ÐºÑƒÑÐºÐ¸, Wi-Fi Ð¸ Ð¿Ð°Ñ€ÐºÐ¾Ð²ÐºÐ° â˜•\n"
    "5ï¸âƒ£ Ð§ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ â€” Ð²ÑÐµ ÑÐ¾ÑÑ‚Ð°Ð²Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð° Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡Ð°Ñ… "
    "Ð² Ð½Ð°ÑˆÐµÐ¹ ÑÑ‚ÑƒÐ´Ð¸Ð¸, Ð° Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ð´Ð°Ñ‘Ð¼ Â«Ñ Ð²Ð¸Ñ‚Ñ€Ð¸Ð½Ñ‹Â» âœ…\n\n"
    "Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
)

PRICES_ANSWER = (
    "ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ†ÐµÐ½Ñ‹ Ð¿Ð¾ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼ (ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ðµ):\n\n"
    "â€¢ Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³-Ð¼Ð¾Ð¹ÐºÐ° â€” Ð¾Ñ‚ 3 000 â‚½\n"
    "â€¢ ÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð°Ñ Ð´ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³-Ð¼Ð¾Ð¹ÐºÐ° Bearlake â€” Ð¾Ñ‚ 8 000 â‚½\n"
    "â€¢ Ð”ÐµÐºÐ¾Ð½Ñ‚Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð›ÐšÐŸ â€” Ð¾Ñ‚ 6 000 â‚½\n"
    "â€¢ ÐœÐ¾Ð¹ÐºÐ° Ð¿Ð¾Ð´ÐºÐ°Ð¿Ð¾Ñ‚Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð° â€” Ð¾Ñ‚ 9 000 â‚½\n"
    "â€¢ ÐŸÐ¾Ð»Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð›ÐšÐŸ (Light Polish) â€” Ð¾Ñ‚ 25 000 â‚½\n"
    "â€¢ ÐšÐµÑ€Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ â€” Ð¾Ñ‚ 5 000 â‚½\n"
    "â€¢ Ð”ÐµÑ‚ÐµÐ¹Ð»Ð¸Ð½Ð³ Ñ‡Ð¸ÑÑ‚ÐºÐ° Ð¸Ð½Ñ‚ÐµÑ€ÑŒÐµÑ€Ð° â€” Ð¾Ñ‚ 28 000 â‚½\n"
    "â€¢ Ð—Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ð¸ÑƒÑ€ÐµÑ‚Ð°Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ð»ÐµÐ½ÐºÐ¸ â€” Ð¾Ñ‚ 85 000 â‚½\n"
    "â€¢ Ð‘Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð»Ð¾Ð±Ð¾Ð²Ð¾Ð³Ð¾ ÑÑ‚ÐµÐºÐ»Ð° â€” Ð¾Ñ‚ 30 000 â‚½\n"
    "â€¢ Ð ÐµÐ¼Ð¾Ð½Ñ‚ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½ Ð¸ ÑÐºÐ¾Ð»Ð¾Ð² ÑÑ‚ÐµÐºÐ»Ð° â€” Ð¾Ñ‚ 3 500 â‚½\n"
    "â€¢ Ð¡Ð°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ 24/7 â€” 700 â‚½/Ñ‡Ð°Ñ Ð¸Ð»Ð¸ 900 â‚½/Ñ‡Ð°Ñ\n\n"
    "*Ð¦ÐµÐ½Ñ‹ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð² (ÐºÑ€Ð¾Ð¼Ðµ ÑÐ°Ð¼Ð¾Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ) Ð·Ð°Ð²Ð¸ÑÑÑ‚ "
    "Ð¾Ñ‚ Ð³Ð°Ð±Ð°Ñ€Ð¸Ñ‚Ð¾Ð² Ð°Ð²Ñ‚Ð¾: S / M / L.*\n\n"
    "Ð”Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð¿Ð¾ Ð²Ð°ÑˆÐµÐ¼Ñƒ Ð°Ð²Ñ‚Ð¾ â€” Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
)

SHOP_RECOMMEND_ANSWER = (
    "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½ÑƒÑŽ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸ÑŽ:\n\n"
    "â€¢ OPT / Optimum Polymer Technologies\n"
    "â€¢ NXTZEN\n"
    "â€¢ IK\n"
    "â€¢ Rayno Crystal Shield\n\n"
    "Ð”Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸-Ð¸ÐºÐ¾Ð½ÐºÐ¸ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
)

SHOP_DISCOUNTS_ANSWER = (
    "ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐºÐ¸Ð´ÐºÐ¸:\n\n"
    "â€¢ Ð’ Ð¾Ñ„Ð»Ð°Ð¹Ð½-Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ â€” 5% Ð´Ð»Ñ Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ñ‹Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²\n"
    "â€¢ ÐÐ° Ozon Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°ÐºÐ°Ð·Ðµ â€” 5% Ð¿Ð¾ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñƒ BEARLAKE\n\n"
    "ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð°ÐºÑ†Ð¸Ð¸ Ñ‚Ð°ÐºÐ¶Ðµ Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÐµÐ¼ Ð² Telegram-ÐºÐ°Ð½Ð°Ð»Ðµ."
)

# ================== Ð˜ÐÐ˜Ð¦Ð˜ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯ OPENAI ==================
client = openai.AsyncOpenAI(api_key=OPENAI_API_KEY)

FULL_SYSTEM_PROMPT = (
    SYSTEM_PROMPT
    + "\n\n# Ð‘ÐÐ—Ð Ð—ÐÐÐÐ˜Ð™ Ð¡Ð¢Ð£Ð”Ð˜Ð˜ BEARLAKE DETAILING & SHOP\n"
    + KNOWLEDGE_BASE
)

# ================== Ð¤Ð£ÐÐšÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ GPT ==================
FALLBACK_RESPONSE = (
    "Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, ÑÐµÐ¹Ñ‡Ð°Ñ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ. "
    "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÐµÑ‰Ñ‘ Ñ€Ð°Ð· Ñ‡ÑƒÑ‚ÑŒ Ð¿Ð¾Ð·Ð¶Ðµ."
)


async def _call_openai(messages: list[dict]) -> str:
    """ÐÐµÐ¿Ð¾ÑÑ€ÐµÐ´ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð² OpenAI API."""
    completion = await client.chat.completions.create(
        model=OPENAI_MODEL,
        messages=messages,
        temperature=0.2,
        max_tokens=500,
    )
    prompt_tokens = completion.usage.prompt_tokens
    completion_tokens = completion.usage.completion_tokens
    total_tokens = completion.usage.total_tokens
    log_token_usage(prompt_tokens, completion_tokens, total_tokens)
    return completion.choices[0].message.content.strip()


async def get_gpt_response(user_text: str, history: list[dict]) -> str:
    """ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð² GPT Ñ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð¼ OPENAI_TIMEOUT ÑÐµÐºÑƒÐ½Ð´."""
    messages = [{"role": "system", "content": FULL_SYSTEM_PROMPT}]
    messages.extend(history)
    messages.append({"role": "user", "content": user_text})

    try:
        return await asyncio.wait_for(
            _call_openai(messages),
            timeout=OPENAI_TIMEOUT,
        )
    except asyncio.TimeoutError:
        logger.error("Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ OpenAI (%d ÑÐµÐº) Ð´Ð»Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°: %r", OPENAI_TIMEOUT, user_text[:80])
        return FALLBACK_RESPONSE
    except Exception as e:
        logger.exception("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ðº OpenAI: %s", e)
        return FALLBACK_RESPONSE

# ================== ÐšÐ­Ð¨ ÐžÐ¢Ð’Ð•Ð¢ÐžÐ’ ÐÐ ÐšÐÐžÐŸÐšÐ˜ ==================
_button_cache: dict[str, tuple[str, float]] = {}


def _get_from_cache(button_data: str) -> str | None:
    """Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¸Ð»Ð¸ None, ÐµÑÐ»Ð¸ ÐºÑÑˆ Ð¿ÑƒÑÑ‚/Ð¸ÑÑ‚Ñ‘Ðº."""
    if button_data not in _button_cache:
        return None
    response, cached_at = _button_cache[button_data]
    if time.time() - cached_at >= CACHE_TTL:
        del _button_cache[button_data]
        return None
    return response


def _put_to_cache(button_data: str, response: str) -> None:
    _button_cache[button_data] = (response, time.time())


# ================== Ð ÐÐ‘ÐžÐ¢Ð Ð¡ Ð˜Ð¡Ð¢ÐžÐ Ð˜Ð•Ð™ Ð”Ð˜ÐÐ›ÐžÐ“Ð ==================
def get_history(context: ContextTypes.DEFAULT_TYPE) -> list[dict]:
    if "history" not in context.chat_data:
        context.chat_data["history"] = []
    return context.chat_data["history"]


def append_to_history(context: ContextTypes.DEFAULT_TYPE, role: str, content: str) -> None:
    history = get_history(context)
    history.append({"role": role, "content": content})
    if len(history) > MAX_HISTORY:
        context.chat_data["history"] = history[-MAX_HISTORY:]


def _check_consent(context: ContextTypes.DEFAULT_TYPE, user_id) -> bool:
    """ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÑÐ¾Ð³Ð»Ð°ÑÐ¸Ðµ: ÑÐ½Ð°Ñ‡Ð°Ð»Ð° ÐºÑÑˆ Ð² chat_data, Ð¿Ð¾Ñ‚Ð¾Ð¼ CSV."""
    if context.chat_data.get("consent"):
        return True
    if has_consent(user_id):
        context.chat_data["consent"] = True
        return True
    return False


def _ensure_fresh_session(context: ContextTypes.DEFAULT_TYPE, chat_id: int) -> None:
    """Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚ ÑÐµÑÑÐ¸ÑŽ Ð¿Ñ€Ð¸ Ð½Ð°ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ð¸ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð´Ð½Ñ."""
    today = dt.date.today().isoformat()
    if context.chat_data.get("last_active_date") == today:
        return
    context.chat_data["history"] = []
    context.chat_data["rated"] = False
    context.chat_data["booking_confirmed"] = False
    context.chat_data["greeted"] = False
    context.chat_data["last_active_date"] = today
    _cancel_user_timers(context.job_queue, chat_id)
    logger.info("ÐÐ¾Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ â€” ÑÐµÑÑÐ¸Ñ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½Ð° Ð´Ð»Ñ Ñ‡Ð°Ñ‚Ð° %s", chat_id)


# ================== Ð¢ÐÐ™ÐœÐ•Ð Ð«: ÐžÐ¦Ð•ÐÐšÐ Ð˜ ÐŸÐžÐ’Ð¢ÐžÐ ÐÐžÐ• Ð’ÐžÐ’Ð›Ð•Ð§Ð•ÐÐ˜Ð• ==================
def _cancel_jobs(job_queue, name: str) -> None:
    """ÐžÑ‚Ð¼ÐµÐ½ÑÐµÑ‚ Ð²ÑÐµ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼ Ð¸Ð¼ÐµÐ½ÐµÐ¼."""
    if not job_queue:
        return
    for job in job_queue.get_jobs_by_name(name):
        job.schedule_removal()


def _cancel_user_timers(job_queue, chat_id: int) -> None:
    """ÐžÑ‚Ð¼ÐµÐ½ÑÐµÑ‚ Ð²ÑÐµ Ñ‚Ð°Ð¹Ð¼ÐµÑ€Ñ‹ (Ð¾Ñ†ÐµÐ½ÐºÐ° + follow-up) Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‚Ð°."""
    _cancel_jobs(job_queue, f"rating_{chat_id}")
    _cancel_jobs(job_queue, f"followup_{chat_id}")


def _schedule_rating(context: ContextTypes.DEFAULT_TYPE, chat_id: int) -> None:
    """ÐŸÐ»Ð°Ð½Ð¸Ñ€ÑƒÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· RATING_DELAY ÑÐµÐºÑƒÐ½Ð´ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ."""
    if not context.job_queue:
        return
    if not context.chat_data.get("booking_confirmed"):
        return
    if context.chat_data.get("rated"):
        return
    name = f"rating_{chat_id}"
    _cancel_jobs(context.job_queue, name)
    context.job_queue.run_once(
        _send_rating_request,
        when=RATING_DELAY,
        chat_id=chat_id,
        name=name,
    )


def _schedule_followup(context: ContextTypes.DEFAULT_TYPE, chat_id: int,
                        user_id: int, topic: str) -> None:
    """ÐŸÐ»Ð°Ð½Ð¸Ñ€ÑƒÐµÑ‚ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ‡ÐµÑ€ÐµÐ· FOLLOWUP_DELAY ÑÐµÐºÑƒÐ½Ð´."""
    if not context.job_queue:
        return
    name = f"followup_{chat_id}"
    _cancel_jobs(context.job_queue, name)
    context.job_queue.run_once(
        _send_followup,
        when=FOLLOWUP_DELAY,
        chat_id=chat_id,
        name=name,
        data={"user_id": user_id, "topic": topic},
    )


async def _send_rating_request(context: ContextTypes.DEFAULT_TYPE) -> None:
    """Job-callback: Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¾Ñ†ÐµÐ½ÐºÐ¸."""
    chat_id = context.job.chat_id
    try:
        await context.bot.send_message(
            chat_id=chat_id,
            text=(
                "ÐšÐ°Ðº Ð²Ñ‹ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°ÐµÑ‚Ðµ ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸ÑŽ? ðŸ™\n"
                "Ð’Ð°ÑˆÐ° Ð¾Ñ†ÐµÐ½ÐºÐ° Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ð°Ð¼ ÑÑ‚Ð°Ñ‚ÑŒ Ð»ÑƒÑ‡ÑˆÐµ!"
            ),
            reply_markup=RATING_KEYBOARD,
        )
    except Exception as e:
        logger.warning("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² %s: %s", chat_id, e)


async def _send_followup(context: ContextTypes.DEFAULT_TYPE) -> None:
    """Job-callback: Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ‡ÐµÑ€ÐµÐ· 24 Ñ‡Ð°ÑÐ°."""
    chat_id = context.job.chat_id
    data = context.job.data or {}
    user_id = data.get("user_id")

    if user_id and not has_consent(user_id):
        return

    topic = data.get("topic", "Ð½Ð°ÑˆÐ¸Ð¼Ð¸ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼Ð¸")
    text = (
        f"Ð”Ð¾Ð±Ñ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ! ðŸ‘‹\n\n"
        f"Ð’Ñ‹ Ð½ÐµÐ´Ð°Ð²Ð½Ð¾ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ¾Ð²Ð°Ð»Ð¸ÑÑŒ {topic}. "
        f"Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ?\n\n"
        f"Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð½Ð¸Ð¶Ðµ â¬‡ï¸"
        f"{PHONE_LINE}"
    )
    try:
        await context.bot.send_message(
            chat_id=chat_id,
            text=text,
            reply_markup=BOOKING_KEYBOARD,
        )
        logger.info("Follow-up Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð² Ñ‡Ð°Ñ‚ %s (Ñ‚ÐµÐ¼Ð°: %s)", chat_id, topic)
    except Exception as e:
        logger.warning("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ follow-up Ð² %s: %s", chat_id, e)


# ================== ÐžÐ‘Ð ÐÐ‘ÐžÐ¢Ð§Ð˜ÐšÐ˜ ÐšÐžÐœÐÐÐ” ==================
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    if update.message is None:
        return

    args = context.args
    source = args[0] if args else "unknown"

    user_id = update.effective_user.id if update.effective_user else "unknown"
    logger.info("ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ %s Ð½Ð°Ñ‡Ð°Ð» Ñ‡Ð°Ñ‚ Ð¸Ð· Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ°: %s", user_id, source)

    log_new_client(user_id, source)

    context.chat_data["history"] = []
    context.chat_data["rated"] = False
    context.chat_data["booking_confirmed"] = False
    context.chat_data["last_active_date"] = dt.date.today().isoformat()
    _cancel_user_timers(context.job_queue, update.effective_chat.id)

    if has_consent(user_id):
        context.chat_data["consent"] = True
        context.chat_data["greeted"] = True
        greeting = (
            "Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼! ðŸ‘‹\n\n"
            "Ð¯ â€” Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº ÑÑ‚ÑƒÐ´Ð¸Ð¸ "
            "BEARLAKE DETAILING & SHOP ðŸ»\n\n"
            "ÐŸÐ¾Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð´Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ ÑƒÑÐ»ÑƒÐ³Ñƒ, Ñ€Ð°ÑÑÐºÐ°Ð¶Ñƒ Ð¾ Ñ†ÐµÐ½Ð°Ñ… "
            "Ð¸ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ…, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð·Ð°Ð¿Ð¸ÑˆÑƒ Ð½Ð° ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ.\n\n"
            "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰Ð¸Ð¹ Ñ€Ð°Ð·Ð´ÐµÐ» â¬‡ï¸ "
            "Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ!"
        )
        append_to_history(context, "assistant", greeting)
        await update.message.reply_text(greeting, reply_markup=GREETING_KEYBOARD)
    else:
        consent_text = (
            "Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ! ðŸ‘‹\n\n"
            "Ð¯ â€” Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº ÑÑ‚ÑƒÐ´Ð¸Ð¸ "
            "BEARLAKE DETAILING & SHOP ðŸ»\n\n"
            "Ð”Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð±Ð¾Ñ‚Ð° Ð¼Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼:\n"
            "â€¢ Ð’Ð°Ñˆ Telegram ID\n"
            "â€¢ Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² Ñ‡Ð°Ñ‚Ðµ\n"
            "â€¢ Ð”Ð°Ñ‚Ñƒ Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¹\n\n"
            "Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð¸ÑÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ "
            "ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼ ÑÑ‚ÑƒÐ´Ð¸Ð¸.\n\n"
            "ðŸ“„ ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ â€” /privacy\n\n"
            "ÐÐ°Ð¶Ð¸Ð¼Ð°Ñ Â«ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÑŽÂ», Ð²Ñ‹ Ð´Ð°Ñ‘Ñ‚Ðµ ÑÐ¾Ð³Ð»Ð°ÑÐ¸Ðµ "
            "Ð½Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… "
            "Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ñ Ð¤Ð—-152."
        )
        await update.message.reply_text(consent_text, reply_markup=CONSENT_KEYBOARD)


def extract_booking_marker(text: str) -> tuple[str, bool]:
    """Ð£Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¼Ð°Ñ€ÐºÐµÑ€ [Ð—ÐÐŸÐ˜Ð¡Ð¬] Ð¸Ð· Ñ‚ÐµÐºÑÑ‚Ð°. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ (Ñ‡Ð¸ÑÑ‚Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚, Ð±Ñ‹Ð» Ð»Ð¸ Ð¼Ð°Ñ€ÐºÐµÑ€)."""
    if BOOKING_MARKER in text:
        return text.replace(BOOKING_MARKER, "").strip(), True
    return text, False


URL_RE = re.compile(r"https?://[^\s)>\]]+")
MD_LINK_RE = re.compile(r"\[([^\]]+)\]\((https?://[^\s)]+)\)")


def _extract_links(text: str) -> tuple[str, list[tuple[str | None, str]]]:
    """Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÑ‚ URL (Ð² Ñ‚.Ñ‡. markdown-ÑÑÑ‹Ð»ÐºÐ¸), ÑƒÐ´Ð°Ð»ÑÑ Ð¸Ñ… Ð¸Ð· Ñ‚ÐµÐºÑÑ‚Ð°."""
    links: list[tuple[str | None, str]] = []

    def md_repl(match: re.Match) -> str:
        label = match.group(1).strip()
        url = match.group(2).strip()
        links.append((label, url))
        return label

    text = MD_LINK_RE.sub(md_repl, text)

    def url_repl(match: re.Match) -> str:
        raw = match.group(0)
        url = raw.rstrip(".,);")
        if url:
            links.append((None, url))
        trailing = raw[len(url):]
        return trailing

    text = URL_RE.sub(url_repl, text)
    text = re.sub(r"[ \t]+\n", "\n", text)
    text = re.sub(r"\n{3,}", "\n\n", text).strip()
    return text, links


def _button_from_link(label: str | None, url: str) -> InlineKeyboardButton:
    """ÐŸÐ¾Ð´Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÐºÐ½Ð¾Ð¿ÐºÑƒ-Ð¸ÐºÐ¾Ð½ÐºÑƒ Ð¿Ð¾Ð´ Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ðµ ÑÑÑ‹Ð»ÐºÐ¸."""
    low = url.lower()
    if "n1024167.yclients.com" in low:
        return InlineKeyboardButton(
            "ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¾Ð½Ð»Ð°Ð¹Ð½",
            web_app=WebAppInfo(url="https://n1024167.yclients.com/"),
        )
    if "yandex.ru/maps" in low:
        return InlineKeyboardButton("ðŸ“ Ð¯Ð½Ð´ÐµÐºÑ ÐšÐ°Ñ€Ñ‚Ñ‹", url=url)
    if "t.me/bearlake_detailing" in low:
        return InlineKeyboardButton("ðŸ”¥ Telegram-ÐºÐ°Ð½Ð°Ð»", url=url)
    if "ozon.ru" in low:
        return InlineKeyboardButton("ðŸ›’ Ozon", url=url)
    if "bearlake.clients.site" in low:
        return InlineKeyboardButton("ðŸª Ð¡Ð°Ð¹Ñ‚ ÑÑ‚ÑƒÐ´Ð¸Ð¸", url=url)
    if "avito.ru" in low:
        return InlineKeyboardButton("ðŸ§¾ Avito", url=url)
    if label:
        short = label.strip()
        if len(short) > 22:
            short = short[:19] + "..."
        return InlineKeyboardButton(f"ðŸ”— {short}", url=url)
    return InlineKeyboardButton("ðŸ”— ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ", url=url)


def _button_key(button: InlineKeyboardButton) -> tuple[str, str, str]:
    web_app = getattr(button, "web_app", None)
    if web_app and getattr(web_app, "url", None):
        return ("web_app", button.text, web_app.url)
    return ("url", button.text, button.url or "")


def _build_reply_markup(
    show_booking: bool,
    links: list[tuple[str | None, str]],
    base_markup: InlineKeyboardMarkup | None = None,
) -> InlineKeyboardMarkup | None:
    """Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ: Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ + Ð·Ð°Ð¿Ð¸ÑÑŒ + ÑÑÑ‹Ð»ÐºÐ¸-Ð¸ÐºÐ¾Ð½ÐºÐ¸."""
    rows: list[list[InlineKeyboardButton]] = []
    if base_markup:
        rows.extend([list(row) for row in base_markup.inline_keyboard])
    if show_booking:
        rows.extend([list(row) for row in BOOKING_KEYBOARD.inline_keyboard])

    seen = {_button_key(btn) for row in rows for btn in row}
    for label, url in links:
        button = _button_from_link(label, url)
        key = _button_key(button)
        if key in seen:
            continue
        rows.append([button])
        seen.add(key)

    return InlineKeyboardMarkup(rows) if rows else None


async def send_answer(message, text: str, force_booking: bool = False) -> None:
    """ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚, Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð¿Ñ€Ð¸ Ð¼Ð°Ñ€ÐºÐµÑ€Ðµ."""
    clean_text, has_marker = extract_booking_marker(text)
    clean_text, links = _extract_links(clean_text)
    show_booking = has_marker or force_booking
    if show_booking:
        clean_text += PHONE_LINE
    reply_markup = _build_reply_markup(show_booking, links)
    await message.reply_text(
        clean_text,
        reply_markup=reply_markup,
        disable_web_page_preview=True,
    )


async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¼ÐµÐ½ÑŽ Ð¸ Ð¿Ð¾Ð´Ð¼ÐµÐ½ÑŽ."""
    query = update.callback_query
    try:
        await query.answer()
    except Exception:
        pass

    user_id = update.effective_user.id if update.effective_user else "unknown"

    if query.data == "consent_accept":
        log_consent(user_id)
        context.chat_data["consent"] = True
        context.chat_data["greeted"] = True
        context.chat_data["history"] = []
        context.chat_data["booking_confirmed"] = False
        greeting = (
            "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾! Ð¡Ð¾Ð³Ð»Ð°ÑÐ¸Ðµ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð¾ âœ…\n\n"
            "ÐŸÐ¾Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð´Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ ÑƒÑÐ»ÑƒÐ³Ñƒ, Ñ€Ð°ÑÑÐºÐ°Ð¶Ñƒ Ð¾ Ñ†ÐµÐ½Ð°Ñ… "
            "Ð¸ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ…, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð·Ð°Ð¿Ð¸ÑˆÑƒ Ð½Ð° ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ.\n\n"
            "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰Ð¸Ð¹ Ñ€Ð°Ð·Ð´ÐµÐ» â¬‡ï¸ "
            "Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ!"
        )
        append_to_history(context, "assistant", greeting)
        await query.message.reply_text(greeting, reply_markup=GREETING_KEYBOARD)
        return

    if query.data == "booking_done":
        context.chat_data["booking_confirmed"] = True
        context.chat_data["rated"] = False
        _cancel_jobs(context.job_queue, f"followup_{query.message.chat_id}")
        _schedule_rating(context, query.message.chat_id)
        await query.message.reply_text(
            "ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾, ÑÐ¿Ð°ÑÐ¸Ð±Ð¾! âœ…\n"
            "Ð§ÐµÑ€ÐµÐ· Ð¿Ð°Ñ€Ñƒ Ð¼Ð¸Ð½ÑƒÑ‚ Ð¿Ð¾Ð¿Ñ€Ð¾ÑˆÑƒ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾ Ð¾Ñ†ÐµÐ½Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸ÑŽ."
        )
        return

    if query.data and query.data.startswith("rate_"):
        rating = int(query.data.split("_")[1])
        log_rating(user_id, rating)
        logger.info("ÐžÑ†ÐµÐ½ÐºÐ° Ð¾Ñ‚ %s: %d â­", user_id, rating)
        context.chat_data["rated"] = True
        _cancel_jobs(context.job_queue, f"rating_{query.message.chat_id}")
        if rating >= 4:
            text = "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð²Ñ‹ÑÐ¾ÐºÑƒÑŽ Ð¾Ñ†ÐµÐ½ÐºÑƒ! ðŸŒŸ Ð Ð°Ð´Ñ‹, Ñ‡Ñ‚Ð¾ ÑÐ¼Ð¾Ð³Ð»Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ!"
        else:
            text = (
                "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¾Ñ‚Ð·Ñ‹Ð²! ðŸ™ ÐœÑ‹ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°ÐµÐ¼ÑÑ ÑÑ‚Ð°Ñ‚ÑŒ Ð»ÑƒÑ‡ÑˆÐµ.\n"
                "Ð•ÑÐ»Ð¸ Ð¾ÑÑ‚Ð°Ð»Ð¸ÑÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ, Ð¸Ð»Ð¸ ÑÐ²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ "
                "Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼: +7 (926) 021-60-00"
            )
        await query.message.reply_text(text)
        return

    if not _check_consent(context, user_id):
        await query.message.reply_text(NO_CONSENT_TEXT)
        return

    _ensure_fresh_session(context, query.message.chat_id)

    if query.data == "menu_advantages":
        log_button_click(user_id, query.data)
        append_to_history(context, "assistant", ADVANTAGES_ANSWER)
        await send_answer(query.message, ADVANTAGES_ANSWER, force_booking=True)
        chat_id = query.message.chat_id
        _schedule_followup(context, chat_id, user_id, "Ð½Ð°ÑˆÐ¸Ð¼Ð¸ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°Ð¼Ð¸")
        return

    if query.data in {"menu_prices", "sub_all_prices"}:
        log_button_click(user_id, query.data)
        user_text = MENU_PROMPTS.get(query.data, "ÐšÐ°ÐºÐ¸Ðµ Ñƒ Ð²Ð°Ñ Ñ†ÐµÐ½Ñ‹ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸?")
        append_to_history(context, "user", user_text)
        append_to_history(context, "assistant", PRICES_ANSWER)
        await send_answer(query.message, PRICES_ANSWER, force_booking=True)
        chat_id = query.message.chat_id
        _schedule_followup(context, chat_id, user_id, "Ñ†ÐµÐ½Ð°Ð¼Ð¸ Ð½Ð° ÑƒÑÐ»ÑƒÐ³Ð¸")
        return

    if query.data == "menu_shop":
        log_button_click(user_id, query.data)
        append_to_history(context, "assistant", "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼ Ð½Ð¸Ð¶Ðµ â¬‡ï¸")
        await query.message.reply_text(
            "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼ Ð½Ð¸Ð¶Ðµ â¬‡ï¸",
            reply_markup=SHOP_KEYBOARD,
            disable_web_page_preview=True,
        )
        chat_id = query.message.chat_id
        _schedule_followup(context, chat_id, user_id, "Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð¼ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸Ð¸")
        return

    if query.data in {"sub_shop_recommend", "sub_shop_discounts"}:
        log_button_click(user_id, query.data)
        user_text = MENU_PROMPTS.get(query.data, "")
        if user_text:
            append_to_history(context, "user", user_text)
        answer = SHOP_RECOMMEND_ANSWER if query.data == "sub_shop_recommend" else SHOP_DISCOUNTS_ANSWER
        append_to_history(context, "assistant", answer)
        await query.message.reply_text(
            answer,
            reply_markup=SHOP_KEYBOARD,
            disable_web_page_preview=True,
        )
        chat_id = query.message.chat_id
        topic = TOPIC_LABELS.get(query.data, "Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð¼ Ð°Ð²Ñ‚Ð¾Ñ…Ð¸Ð¼Ð¸Ð¸")
        _schedule_followup(context, chat_id, user_id, topic)
        return

    user_text = MENU_PROMPTS.get(query.data)
    if not user_text:
        return

    chat_id = query.message.chat_id

    logger.info("ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚ %s: %s â†’ %r", user_id, query.data, user_text)
    log_button_click(user_id, query.data)
    log_question(user_id, user_text)

    static_answer = STATIC_MENU_ANSWERS.get(query.data)
    if static_answer:
        answer = static_answer
    else:
        cached = _get_from_cache(query.data)
        if cached:
            logger.info("ÐšÑÑˆ-Ð¿Ð¾Ð¿Ð°Ð´Ð°Ð½Ð¸Ðµ: %s", query.data)
            answer = cached
        else:
            try:
                await context.bot.send_chat_action(chat_id=chat_id, action="typing")
            except Exception as e:
                logger.warning("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ 'typing': %s", e)

            history = get_history(context)
            answer = await get_gpt_response(user_text, history)

            if answer != FALLBACK_RESPONSE:
                _put_to_cache(query.data, answer)

    append_to_history(context, "user", user_text)
    append_to_history(context, "assistant", answer)

    sub_menu = SUB_MENUS.get(query.data)
    if sub_menu:
        clean_text, has_marker = extract_booking_marker(answer)
        clean_text, links = _extract_links(clean_text)
        reply_markup = _build_reply_markup(has_marker, links, base_markup=sub_menu)
        await query.message.reply_text(
            clean_text,
            reply_markup=reply_markup,
            disable_web_page_preview=True,
        )
    else:
        await send_answer(query.message, answer)

    topic = TOPIC_LABELS.get(query.data, "Ð½Ð°ÑˆÐ¸Ð¼Ð¸ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼Ð¸")
    context.chat_data["last_topic"] = topic
    _schedule_followup(context, chat_id, user_id, topic)


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    if update.message is None or update.message.text is None:
        return

    user_text = update.message.text.strip()
    chat_id = update.effective_chat.id
    user_id = update.effective_user.id if update.effective_user else "unknown"

    if not _check_consent(context, user_id):
        await update.message.reply_text(NO_CONSENT_TEXT)
        return

    _ensure_fresh_session(context, chat_id)

    if not context.chat_data.get("greeted"):
        context.chat_data["greeted"] = True
        greeting = (
            "Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼! ðŸ‘‹\n\n"
            "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» Ð¸Ð»Ð¸ Ð·Ð°Ð´Ð°Ð¹Ñ‚Ðµ Ð²Ð¾Ð¿Ñ€Ð¾Ñ â¬‡ï¸"
        )
        await update.message.reply_text(greeting, reply_markup=GREETING_KEYBOARD)

    logger.info("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ %s: %r", user_id, user_text)

    log_question(user_id, user_text)

    try:
        await context.bot.send_chat_action(chat_id=chat_id, action="typing")
    except Exception as e:
        logger.warning("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ 'typing': %s", e)

    text_lower = user_text.lower()

    if (
        "Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²" in text_lower
        or "Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð²Ñ‹" in text_lower
        or "Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²Ð°Ñ" in text_lower
        or "Ñ‡ÐµÐ¼ Ð²Ñ‹ Ð»ÑƒÑ‡ÑˆÐµ Ð´Ñ€ÑƒÐ³Ð¸Ñ…" in text_lower
        or "Ñ‡ÐµÐ¼ Ð²Ñ‹ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð°ÐµÑ‚ÐµÑÑŒ" in text_lower
    ):
        append_to_history(context, "user", user_text)
        append_to_history(context, "assistant", ADVANTAGES_ANSWER)
        await send_answer(update.message, ADVANTAGES_ANSWER, force_booking=True)
        _schedule_followup(context, chat_id, user_id, "Ð½Ð°ÑˆÐ¸Ð¼Ð¸ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°Ð¼Ð¸")
        return

    history = get_history(context)
    answer = await get_gpt_response(user_text, history)

    append_to_history(context, "user", user_text)
    append_to_history(context, "assistant", answer)

    await send_answer(update.message, answer)

    topic = context.chat_data.get("last_topic", "Ð½Ð°ÑˆÐ¸Ð¼Ð¸ ÑƒÑÐ»ÑƒÐ³Ð°Ð¼Ð¸")
    _schedule_followup(context, chat_id, user_id, topic)

# ================== ÐšÐžÐœÐÐÐ”Ð« ÐŸÐ” ==================
async def privacy_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÑƒ ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸."""
    if update.message is None:
        return
    await update.message.reply_text(PRIVACY_TEXT)


async def deletedata_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ð£Ð´Ð°Ð»ÑÐµÑ‚ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸ Ð¾Ñ‚Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ¾Ð³Ð»Ð°ÑÐ¸Ðµ."""
    if update.message is None:
        return

    user_id = update.effective_user.id if update.effective_user else 0
    _cancel_user_timers(context.job_queue, update.effective_chat.id)
    result = delete_user_data(user_id)
    context.chat_data.clear()

    if result:
        details = "\n".join(f"  â€¢ {f}: {n} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹" for f, n in result.items())
        text = (
            "âœ… Ð’ÑÐµ Ð²Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹:\n"
            f"{details}\n\n"
            "Ð¡Ð¾Ð³Ð»Ð°ÑÐ¸Ðµ Ð½Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¾Ñ‚Ð¾Ð·Ð²Ð°Ð½Ð¾.\n"
            "Ð”Ð»Ñ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð±Ð¾Ñ‚Ð° Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ /start"
        )
    else:
        text = (
            "â„¹ï¸ Ð”Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾.\n\n"
            "Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ ÑÐ½Ð°Ñ‡Ð°Ð»Ð° â€” /start"
        )

    await update.message.reply_text(text)


# ================== ÐÐ”ÐœÐ˜Ð-ÐšÐžÐœÐÐÐ”Ð« ==================
async def report_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ."""
    user_id = update.effective_user.id if update.effective_user else 0
    if ADMIN_USER_ID and user_id != ADMIN_USER_ID:
        await update.message.reply_text("â›” Ð­Ñ‚Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ.")
        return

    await update.message.reply_text("ðŸ“Š Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑŽ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚, Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ...")

    try:
        text_summary = generate_text_summary()
        report_path = generate_monthly_report()

        await update.message.reply_text(text_summary)
        with open(report_path, "rb") as f:
            await update.message.reply_document(
                document=f,
                filename=os.path.basename(report_path),
                caption="ðŸ“Ž Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°Ð¼Ð¸",
            )
    except Exception as e:
        logger.exception("ÐžÑˆÐ¸Ð±ÐºÐ° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°: %s", e)
        await update.message.reply_text(f"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°: {e}")


async def clearcache_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """ÐžÑ‡Ð¸Ñ‰Ð°ÐµÑ‚ ÐºÑÑˆ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸."""
    user_id = update.effective_user.id if update.effective_user else 0
    if ADMIN_USER_ID and user_id != ADMIN_USER_ID:
        await update.message.reply_text("â›” Ð­Ñ‚Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ.")
        return

    count = len(_button_cache)
    _button_cache.clear()
    await update.message.reply_text(f"ðŸ—‘ ÐšÑÑˆ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½ ({count} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹)")


# ================== ÐÐ’Ð¢ÐžÐžÐ¢Ð§ÐÐ¢ ==================
async def send_monthly_report(context: ContextTypes.DEFAULT_TYPE) -> None:
    """ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° Ð¿Ñ€Ð¾ÑˆÐ»Ñ‹Ð¹ Ð¼ÐµÑÑÑ† 1-Ð³Ð¾ Ñ‡Ð¸ÑÐ»Ð°."""
    if not ADMIN_USER_ID:
        logger.warning("ADMIN_USER_ID Ð½Ðµ Ð·Ð°Ð´Ð°Ð½, Ð°Ð²Ñ‚Ð¾Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½.")
        return

    logger.info("ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¼ÐµÑÑÑ‡Ð½Ð¾Ð³Ð¾ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°...")

    try:
        now = dt.datetime.now()
        prev = now.replace(day=1) - dt.timedelta(days=1)

        text_summary = generate_text_summary(prev.year, prev.month)
        report_path = generate_monthly_report(prev.year, prev.month)

        await context.bot.send_message(
            chat_id=ADMIN_USER_ID,
            text=f"ðŸ“Š ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚\n\n{text_summary}",
        )
        with open(report_path, "rb") as f:
            await context.bot.send_document(
                chat_id=ADMIN_USER_ID,
                document=f,
                filename=os.path.basename(report_path),
                caption="ðŸ“Ž Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ñ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°Ð¼Ð¸",
            )
        logger.info("ÐÐ²Ñ‚Ð¾Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° %s-%02d Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½.", prev.year, prev.month)
    except Exception as e:
        logger.exception("ÐžÑˆÐ¸Ð±ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°: %s", e)
        try:
            await context.bot.send_message(
                chat_id=ADMIN_USER_ID,
                text=f"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð°Ð²Ñ‚Ð¾Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°: {e}",
            )
        except Exception:
            pass


# ================== Ð—ÐÐŸÐ£Ð¡Ðš ==================
async def post_init(application: Application) -> None:
    """Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÑ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð² Ð¼ÐµÐ½ÑŽ Telegram Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°."""
    await application.bot.set_my_commands([
        BotCommand("start", "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ"),
        BotCommand("privacy", "ðŸ”’ ÐŸÐ¾Ð»Ð¸Ñ‚Ð¸ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸"),
        BotCommand("deletedata", "ðŸ—‘ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ"),
    ])
    logger.info("ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð° Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð² Ð¼ÐµÐ½ÑŽ Telegram.")


def main() -> None:
    request = HTTPXRequest()
    application = (
        Application.builder()
        .token(TELEGRAM_BOT_TOKEN)
        .request(request)
        .post_init(post_init)
        .build()
    )

    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("privacy", privacy_command))
    application.add_handler(CommandHandler("deletedata", deletedata_command))
    application.add_handler(CommandHandler("report", report_command))
    application.add_handler(CommandHandler("clearcache", clearcache_command))
    application.add_handler(CallbackQueryHandler(button_callback))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    if ADMIN_USER_ID and application.job_queue:
        msk = dt.timezone(dt.timedelta(hours=3))
        application.job_queue.run_monthly(
            send_monthly_report,
            when=dt.time(hour=9, minute=0, tzinfo=msk),
            day=1,
        )
        logger.info("ÐÐ²Ñ‚Ð¾Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½: 1-Ðµ Ñ‡Ð¸ÑÐ»Ð¾ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¼ÐµÑÑÑ†Ð°, 09:00 ÐœÐ¡Ðš")

    logger.info("Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½. ÐžÐ¶Ð¸Ð´Ð°ÑŽ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ...")
    application.run_polling(
        allowed_updates=Update.ALL_TYPES,
        drop_pending_updates=True,
    )


if __name__ == "__main__":
    main()